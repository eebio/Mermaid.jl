<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Mermaid.jl</title><meta name="title" content="Tutorial · Mermaid.jl"/><meta property="og:title" content="Tutorial · Mermaid.jl"/><meta property="twitter:title" content="Tutorial · Mermaid.jl"/><meta name="description" content="Documentation for Mermaid.jl."/><meta property="og:description" content="Documentation for Mermaid.jl."/><meta property="twitter:description" content="Documentation for Mermaid.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mermaid.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Components"><span>Components</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li><li><a class="tocitem" href="#Solving-the-hybrid-model"><span>Solving the hybrid model</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/mtk/">ModelingToolkit</a></li></ul></li><li><a class="tocitem" href="../interface/">Mermaid Interface</a></li><li><a class="tocitem" href="../is_mermaid_right_for_me/">Is Mermaid right for me?</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will:</p><ul><li>Create a hybrid simulation between an Agent-based model, defined in Agents.jl, and an ODE system defined through DifferentialEquations.jl.</li><li>Introduce Mermaid Components for Agents.jl and DifferentialEquations.jl.</li><li>Demonstrate how these Components can be connected together through Connections.</li><li>Solve the hybrid model.</li><li>Visualise the results of the simulation.</li></ul><p>The example system we will use for this will be a model of a forest fire (governed by an Agent-based model), with the growth of each tree informed by an ODE model.</p><h2 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h2><p>To begin, we need to define our components. These will be an ODE model component for each tree, and an Agent-based model component for handling the forest level properties (in this case, the spread of heat/fire).</p><h3 id="ODE-Components"><a class="docs-heading-anchor" href="#ODE-Components">ODE Components</a><a id="ODE-Components-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Components" title="Permalink"></a></h3><p>To define the ODE model, let&#39;s have a look at how to define an ODE Component.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.ODEComponent-tutorial" href="#Mermaid.ODEComponent-tutorial"><code>Mermaid.ODEComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an ODE system, defined by an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">ODEProblem</a>.</p><p><strong>Fields</strong></p><ul><li><code>model::ODEProblem</code>: The ODE problem to be solved.</li><li><code>name::String=&quot;ODE Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping variable names (as strings) to their corresponding indices in the state vector or symbols from <a href="https://docs.sciml.ai/ModelingToolkit/stable/">ModelingToolkit</a>/<a href="https://docs.sciml.ai/Symbolics/stable/">Symbolics</a>.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ODE solver timestep), i.e. how frequently should the inputs and outputs be updated.</li><li><code>alg=Rodas5()</code>: The algorithm used for solving the ODEProblem.</li><li><code>intkwargs::Tuple=()</code>: Additional keyword arguments for the ODE solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/DiffEq.jl#L5-L16">source</a></section></article><p>We see that we need to define an <code>ODEProblem</code> to use in the component, so let&#39;s create one.</p><pre><code class="language-julia hljs">using DifferentialEquations
function tree!(du, u, p, t)
    x, y = u
    du[1] = 0
    du[2] = y*(1-y/10.0)-x*y
end
u0 = [4.0, 2.0]
tspan = (0.0, 10.0)
prob = ODEProblem(tree!, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#56b6c2">ODEProblem</span> with uType <span class="sgr38_2" style="color:#56b6c2">Vector{Float64}</span> and tType <span class="sgr38_2" style="color:#56b6c2">Float64</span>. In-place: <span class="sgr38_2" style="color:#56b6c2">true</span>
Non-trivial mass matrix: <span class="sgr38_2" style="color:#56b6c2">false</span>
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 4.0
 2.0</code></pre><p>Next, we want to wrap this ODEProblem inside an ODEComponent. For this, we will need to define the <code>state_names</code> field, and should generally provide a value for the <code>name</code> field (since component names in a hybrid simulation should be unique).</p><pre><code class="language-julia hljs">using Mermaid
comp1 = ODEComponent(
    model=prob,
    name=&quot;tree&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ())</code></pre><h3 id="Duplicated-Components"><a class="docs-heading-anchor" href="#Duplicated-Components">Duplicated Components</a><a id="Duplicated-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Duplicated-Components" title="Permalink"></a></h3><p>Since the <code>ODEProblem</code> is defined for only a single tree, we can efficiently simulate the ODE by generating a duplicated component. This component stores a single <code>ODEProblem</code> will solve across many different states. In this case, we can have a state for each tree in the Agent-based model. Let&#39;s have a look at how to define a <a href="../API/#Mermaid.DuplicatedComponent">DuplicatedComponent</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.DuplicatedComponent-tutorial" href="#Mermaid.DuplicatedComponent-tutorial"><code>Mermaid.DuplicatedComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DuplicatedComponent &lt;: AbstractComponent</code></pre><p>Represents a component that is duplicated in the simulation, allowing a single component to have multiple states.</p><p><strong>Fields</strong></p><ul><li><code>component::AbstractTimeDependentComponent</code>: The original component to be duplicated.</li><li><code>instances::Union{Int,Nothing}</code>: Number of instances of the component. If <code>nothing</code>, then the number is variable and determined by the simulation.</li><li><code>name::String</code>: Name of the duplicated component.</li><li><code>initial_states::Vector</code>: Vector of states for the duplicated component, where each state corresponds to a particular instance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/Duplicated.jl#L3-L13">source</a></section></article><pre><code class="language-julia hljs">dup_comp = DuplicatedComponent(
    component=comp1,
    instances=640,
    initial_states=[copy(u0) for _ in 1:640]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DuplicatedComponent(ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ()), 640, &quot;tree&quot;, [[4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]  …  [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]], 1.0, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2))</code></pre><h3 id="Agents.jl-Components"><a class="docs-heading-anchor" href="#Agents.jl-Components">Agents.jl Components</a><a id="Agents.jl-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Agents.jl-Components" title="Permalink"></a></h3><p>Now that we have created our <a href="../API/#Mermaid.ODEComponent">ODEComponent</a>, we can move on to the <a href="../API/#Mermaid.AgentsComponent">AgentsComponent</a>, so let&#39;s have a look at its documentation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.AgentsComponent-tutorial" href="#Mermaid.AgentsComponent-tutorial"><code>Mermaid.AgentsComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AgentsComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an agent-based model (ABM) using the Agents.jl package.</p><p><strong>Fields</strong></p><ul><li><code>model::StandardABM</code>: The agent-based model to be solved.</li><li><code>name::String=&quot;Agents Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping ConnectedVariable names (as strings) to their corresponding properties in the agent model. The properties differentiate between <code>:model</code> properties and <code>:agent</code> properties.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ABM solver timestep), i.e. how frequently should the inputs and outputs be updated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/Agents.jl#L5-L15">source</a></section></article><p>We can see that, again, we need to define the model (this time a <code>StandardABM</code> from <code>Agents.jl</code>), a <code>name</code> and a <code>state_names</code>.</p><pre><code class="language-julia hljs">using Agents, Random, Statistics
@agent struct Tree(GridAgent{2})
    heat::Float64 # Heat is averaged across neighbors, passed to ODE model
    life::Float64 # Life is informed by ODE model
end

function forest_fire(; density=0.4, griddims=(40, 40), seed=2)
    space = GridSpaceSingle(griddims; periodic=false, metric=:chebyshev)
    rng = Random.MersenneTwister(seed)
    forest = StandardABM(Tree, space; rng, agent_step! = tree_step!)
    for _ in 1:floor(density * prod(griddims))
        # Randomly place trees in the grid
        add_agent_single!(forest; heat=rand(), life=rand())
    end
    return forest
end

function tree_step!(tree, forest)
    nearbyheat = mean([getproperty(neighbor, :heat) for neighbor in nearby_agents(tree, forest, 1)])
    if isnan(nearbyheat)
        nearbyheat = 0.0
    end
    tree.heat = tree.heat * 0.9 + nearbyheat * 0.1
    if rand(abmrng(forest)) &lt; 1e-4 # Random chance of fire
        tree.heat = 10.0
    end
    # Simulate tree life cycle
    if tree.heat &gt; 1.0 &amp;&amp; tree.life &gt; 0
        # Tree on fire
        tree.heat += 1.0
    else
        # Tree not on fire so heat disappates
        tree.heat -= 0.1
    end
    if tree.heat &lt; 0.0
        tree.heat = 0.0
    end
end

forest = forest_fire()

comp2 = AgentsComponent(
    model=forest,
    name=&quot;forest&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentsComponent(StandardABM with 640 agents of type Tree
 agents container: Dict
 space: GridSpaceSingle with size (40, 40), metric=chebyshev, periodic=false
 scheduler: fastest, &quot;forest&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life), 1.0)</code></pre><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p>We can now set up the connections between the variables in the two components.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.Connector-tutorial" href="#Mermaid.Connector-tutorial"><code>Mermaid.Connector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Connector</code></pre><p>Represents a connection between multiple <a href="../API/#Mermaid.ConnectedVariable">ConnectedVariables</a>, possibly with a transformation function.</p><p><strong>Fields</strong></p><ul><li><code>inputs::Vector{ConnectedVariable}</code>: Input variables for the connector.</li><li><code>outputs::Vector{ConnectedVariable}</code>: Output variables for the connector.</li><li><code>func::Union{Nothing,Function}</code>: Optional function to transform inputs to outputs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/types.jl#L36-L45">source</a></section></article><pre><code class="language-julia hljs">conn1 = Connector(inputs=[&quot;forest.heat[1:640]&quot;], outputs=[&quot;tree[1:640].heat&quot;])
conn2 = Connector(inputs=[&quot;tree[1:640].life&quot;], outputs=[&quot;forest.life[1:640]&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Connector(ConnectedVariable[ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, 1:640)], ConnectedVariable[ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, 1:640, nothing)], nothing)</code></pre><h2 id="Solving-the-hybrid-model"><a class="docs-heading-anchor" href="#Solving-the-hybrid-model">Solving the hybrid model</a><a id="Solving-the-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-hybrid-model" title="Permalink"></a></h2><p>To create the hybrid model, we need to create a <a href="../API/#Mermaid.MermaidProblem">MermaidProblem</a>. We can then solve this using the <code>CommonSolve</code> interface.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidProblem-tutorial" href="#Mermaid.MermaidProblem-tutorial"><code>Mermaid.MermaidProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidProblem</code></pre><p>Struct for defining a Mermaid problem. This struct contains the components, connectors and other properties of the hybrid simulation.</p><p><strong>Fields</strong></p><ul><li><code>components::Vector</code>: Vector of Components.</li><li><code>connectors::Vector{Connector}</code>: Vector of <a href="../API/#Mermaid.Connector">Connector</a>.</li><li><code>max_t::Float64</code>=1.0: Maximum simulation time.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/types.jl#L112-L122">source</a></section></article><pre><code class="language-julia hljs">mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2], max_t=10.0)
alg = MinimumTimeStepper()
sol = solve(mp, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MermaidSolution(Any[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0], Dict{Any, Any}(ConnectedVariable(&quot;forest&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[[0.9688148037349712, 0.30580254138909424, 0.19843955137800917, 0.23593892152083817, 0.05648414351988118, 0.5847860267454636, 0.5737108317357609, 0.28936583268722993, 0.2987317710474081, 0.7826752620369738  …  0.7278806650861672, 0.30727252466151067, 0.060814615276352346, 0.906518829835159, 0.20655938744012536, 0.7313824966768133, 0.25815174901557447, 0.19983358354715652, 0.19234948709100108, 0.4798927670064317], [0.8286064161551345, 0.23105478431351487, 0.13570532293191562, 0.19229178917578008, 0.0010714840154187055, 0.47823147747620354, 0.484109425351254, 0.18574184180405326, 0.1688585939426673, 0.6518658280375049  …  0.5967633879368459, 0.19953472575005246, 0.0, 0.773533853982519, 0.12355701977444558, 0.6033513800980179, 0.19740742700312205, 0.1302912807660557, 0.13200971382068835, 0.3806383178760143], [0.692357497707474, 0.15198213220633308, 0.06751215284601828, 0.1392394680503244, 0.0, 0.37103960939548664, 0.393244479702918, 0.08299454228909459, 0.05197273454840057, 0.5245728934474801  …  0.4687881394903394, 0.09418306821097258, 0.0, 0.6436600245394539, 0.03745828902320944, 0.4778448962588371, 0.1304462164196261, 0.055187397754125594, 0.06466527014802967, 0.2800325408239338], [0.5595753300752194, 0.06926362922901089, 0.0, 0.07829891995180369, 0.0, 0.26345090224653767, 0.3011848478985689, 0.0, 0.0, 0.4006448175489097  …  0.34410081327473585, 0.0, 0.0, 0.5164482037336108, 0.0, 0.3579975345839669, 0.05811393097236148, 0.0, 0.0, 0.1786185520231617], [0.42998095746572995, 0.0, 0.0, 0.010732906340325976, 0.0, 0.15567809959474274, 0.20800342289076892, 0.0, 0.0, 0.28046640971917547  …  0.224984879449977, 0.0, 0.0, 0.39170681019466713, 0.0, 0.2439615412274128, 0.0, 0.0, 0.0, 0.07852939003883577], [0.30565412320479, 0.0, 0.0, 0.0, 0.0, 0.05266619542794143, 0.11377465771280146, 0.0, 0.0, 0.16434622634084436  …  0.11123624289945785, 0.0, 0.0, 0.26928621230163785, 0.0, 0.1352742444080979, 0.0, 0.0, 0.0, 0.0], [0.18649503133042253, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01857272808916327, 0.0, 0.0, 0.05271741749545916  …  0.0032333912604726595, 0.0, 0.0, 0.1490730238033531, 0.0, 0.031613091851055874, 0.0, 0.0, 0.0, 0.0], [0.07207565733251564, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0341657214230178, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], ConnectedVariable(&quot;tree&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[Any[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0  …  4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0], Any[0.9999833281521459, 0.23366350246269163, 0.8030861740718434, 0.9444057930256794, 0.5945003359263897, 0.7440286356605417, 0.710185958624644, 0.30156139897997025, 0.1847219197235518, 0.6082344559139129  …  0.27733069596775695, 0.6172514488294182, 0.5838544370486162, 0.8700070313464333, 0.9122278267541646, 0.16113652033741221, 0.31544886103347436, 0.5847860267454636, 0.19464187036418745, 0.39367430643889356], Any[0.8500604843601142, 0.15443703566629471, 0.6907289716177993, 0.7990416052580908, 0.5062969900345583, 0.6151164451142602, 0.5549427968292825, 0.2054710832235813, 0.09231766842622391, 0.5070713003550394  …  0.22450314509859134, 0.49605101892865877, 0.48977529144636556, 0.7668939735181172, 0.7524426403132363, 0.1355790843095883, 0.24620667620689976, 0.47823147747620354, 0.10923745488467715, 0.3035765574244912], Any[0.7070136397003939, 0.07243503150546812, 0.5792591685727705, 0.65930876213357, 0.41490460909191984, 0.48991472790553114, 0.40827076412464325, 0.10978554023515788, 0.0, 0.40468056543279907  …  0.16323053837193838, 0.3774094691377039, 0.3948692763431132, 0.6619605757486157, 0.6001897590271047, 0.09855663049320887, 0.1720218106003061, 0.37103960939548664, 0.023671371214388642, 0.21151426073680504], Any[0.5697431795587659, 1.8515489150903204e-16, 0.4684996771902581, 0.5243360932732116, 0.3208341529122891, 0.3678009114853924, 0.272186239828039, 0.014174885281960176, 3.3416624382268057e-16, 0.3012976181032232  …  0.09485104231720098, 0.2611091719411084, 0.299137348566192, 0.5555137574936089, 0.4544048851569795, 0.05170264296792251, 0.09359083704197735, 0.26345090224653767, -1.3202136013122036e-18, 0.11894149302170992], Any[0.4381924032083374, 5.124679496976642e-16, 0.35834632285994084, 0.3933980721597744, 0.22452157079891957, 0.24826499148668232, 0.14599715607748678, -1.2982800223442812e-18, 3.081539088437622e-17, 0.19830672043420874  …  0.020590804645033673, 0.14919282711166695, 0.2036976292585063, 0.44782461663914597, 0.31489851996383655, 5.087117855417614e-16, 0.011511820326165795, 0.15567809959474274, -5.4406850703752526e-17, 0.026825908633573592], Any[0.3119851320326945, 0.0, 0.24873853349152028, 0.26588913165499817, 0.12641630302498344, 0.13250471609491862, 0.03139744046973811, 3.0894958186150096e-17, -6.242756534793129e-17, 0.09684762844479575  …  -5.0247418153691536e-17, 0.04137565965180043, 0.10907262818732892, 0.3391955690699112, 0.184889517222979, 0.0, 1.9922319761559223e-16, 0.05266619542794143, -8.831835069329e-17, 0.0], Any[0.19049741088771346, -3.889768963479144e-17, 0.13963808696649024, 0.14130266078352638, 0.026976184713881718, 0.02137587775856228, 0.0, 1.839391420063722e-17, -1.5144146118576704e-17, 1.0160257832817354e-15  …  7.76900617531188e-17, -2.912319036873715e-16, 0.015310552059915578, 0.22992078460670592, 0.0664005655006811, -4.529817639796628e-17, 3.1982848225592587e-19, -1.571941512850506e-16, 2.125459782490033e-18, -1.2819862238347143e-16], Any[0.07443217701443561, -9.782678993247748e-19, 0.03360983606526004, 0.02717239470517374, 4.1584397806971904e-16, 0.0, -2.757914352303408e-20, 0.0, -1.0608040292164924e-17, -1.0335519796140444e-16  …  1.6373454258267934e-17, 1.9941649038514384e-16, 0.0, 0.12030858494394495, 3.1926500492546716e-16, -7.150989229342597e-18, -4.6848459091788797e-17, 2.999001658383528e-16, 1.7251133838188993e-18, -1.0682364932309357e-16], Any[0.0, 6.43221103887411e-18, -1.3731315668436923e-16, -6.709732322789164e-17, 1.8508753220212587e-17, 0.0, -3.500961711385888e-17, -1.3357961416368996e-17, -1.7752364496865804e-18, 3.350156657865125e-17  …  -9.339158527791349e-18, -4.756096651859e-17, -5.23899513271296e-17, 0.01083514663886112, 0.0, 4.261205532760867e-18, 2.448994378237694e-17, 1.814872167802844e-20, -1.1402963083419072e-18, 2.0743992020816952e-17], Any[7.924252117209752e-20, 3.3297980429585908e-18, 6.433224500783253e-17, -3.047885062225874e-17, 1.9358570586655607e-20, 5.652217253053021e-17, -4.614981635957254e-18, -7.553089196360165e-19, -3.175247521879954e-21, -5.50295269696967e-21  …  1.3584405194951032e-21, -1.6214540633871352e-17, -2.480873853230127e-20, -3.74741992383816e-17, 3.9604034117518346e-18, -1.0177722052812606e-21, -1.5167846607833372e-18, 2.228906239451481e-17, 3.8324309503492156e-18, -6.898979981340005e-18]], ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[[0.9882380405209834, 0.39435516404459836, 0.45249097914172065, 0.9453339518799103, 0.7959110929469593, 0.7726140619081256, 0.9433880802938431, 0.29097558327594775, 0.2529225942199588, 0.21848270303536288  …  0.8489996671565165, 0.4316962442323975, 0.6011233365030743, 0.5243237303627087, 0.7636006570831086, 0.873560174827632, 0.43182937187670256, 0.9172549936178823, 0.2683688216581718, 0.08805244952657698], [1.7149574828730887, 3.107145822404549, 3.4117874550217446, 3.3024491453749016, 3.8556352315740643, 2.427555358135483, 2.4516960527819096, 3.1521334055326946, 3.1264285912586542, 2.031635546655276  …  2.1347894602767172, 3.103153750926727, 3.841354644488901, 1.8153902726258384, 3.3878286092769514, 2.1280539288459672, 3.2391868166734605, 3.407661151522242, 3.4298482998325883, 2.665235938978947], [1.7147964827710174, 4.567388811585466, 5.250768239028964, 4.9112232969825955, 6.298981455771482, 3.1018702034976884, 3.109302484367936, 4.786091185960715, 4.825686788377923, 2.3150596055979413  …  2.5298576478826216, 4.682811812819963, 6.290110923417283, 1.891431726409208, 5.277978590002086, 2.5087900314699842, 4.828264358448994, 5.26942208634897, 5.284481911625982, 3.616476312794799], [1.9424747603491366, 6.204077313753013, 7.143457303210504, 6.529595061978666, 8.222697586989925, 4.063304306017262, 3.995401638803811, 6.712451331197748, 6.900981342527604, 2.8727483404308174  …  3.2262197124175818, 6.575082804736503, 8.217147724090042, 2.201007168746564, 7.322208580813562, 3.1810163635316395, 6.51003515386172, 7.221831331805127, 7.182904768620201, 4.857150343136191], [2.425425992917355, 7.774221822287223, 8.717630278974621, 7.920248525610634, 9.26342009973437, 5.302410033319807, 5.091893140421766, 8.473330882397507, 8.58221143609995, 3.7539851825766912  …  4.269856758983717, 8.391906674332514, 9.260826669861151, 2.782181571065336, 8.81420025251758, 4.180163890023194, 8.021431332580088, 8.760260317585203, 8.73913269584869, 6.299172627881671], [3.2322301687630444, 9.047123660601384, 9.486640783913982, 9.054233999432684, 9.715799136822492, 6.729744208644265, 6.328046107305507, 9.378391178285822, 9.427091636740046, 4.974595818204592  …  5.634442285913343, 9.341483713563107, 9.71474898550459, 3.696201113422562, 9.52842605700092, 5.47984609868386, 9.168110963439418, 9.505159647447387, 9.49598808577441, 7.78151277876185], [4.413002767323617, 9.626993844219568, 9.80481216820243, 9.629958692531087, 9.893536262375354, 8.180158741170189, 7.606574070075898, 9.761985787975188, 9.781319449366919, 6.454053983901409  …  7.182535131246775, 9.747225574111672, 9.893135125439425, 4.9693063476969055, 9.821189337922466, 6.954321029041733, 9.67700596184716, 9.812082276218128, 9.808483117852035, 9.05075701900485], [5.9211756183519, 9.859465544966707, 9.927297441996371, 9.860611288326098, 9.96056875435107, 9.243506542947934, 8.851495913995322, 9.911102078898693, 9.918424506983344, 8.018422575258192  …  8.719798205587699, 9.905499742178721, 9.960419147521025, 6.524547109492938, 9.93346739260346, 8.427921106422021, 9.878700779792126, 9.93003819362463, 9.928681837983383, 9.628507276560613], [7.5797029656118005, 9.947836837372268, 9.973130621210343, 9.948265902323865, 9.98545774265294, 9.707727968641915, 9.544425487844581, 9.967111422676835, 9.96983445103549, 9.166637556262213  …  9.487587933392073, 9.965026293375153, 9.9854023649698, 8.165415178245429, 9.975420597874857, 9.357854326491214, 9.955031666306276, 9.974148026489528, 9.973644613168979, 9.860050393734673], [8.948932279310382, 9.98074640836777, 9.99009843289425, 9.980905580751124, 9.994645220961736, 9.890455504905525, 9.827438435762538, 9.98787573060443, 9.988881457633502, 9.676402108797266  …  9.805187904111706, 9.987105280469352, 9.994624804182319, 9.236648314885944, 9.990943625109036, 9.753773808747342, 9.983409890314414, 9.990473795170614, 9.990287983693205, 9.948055868019612], [9.58585508048907, 9.992908188242403, 9.996355110941511, 9.992966887936506, 9.998029363652996, 9.959419569525178, 9.935818404807202, 9.995536304427771, 9.995906728600794, 9.878472740950967  …  9.927439773519083, 9.995252300624388, 9.998021847437307, 9.704964361063139, 9.99666643356758, 9.907987986171921, 9.993890273714719, 9.996493296770474, 9.996424855605541, 9.980827518721949]], ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[Any[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0  …  2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0], Any[1.6666941885957365, 3.3089913258223955, 1.994413013115896, 1.7536712371645093, 2.4065617080117643, 2.103894206148684, 2.169128171309136, 3.1186999899597168, 3.4525869780577847, 2.377166540217056  …  3.185443823017162, 2.3580482453158123, 2.4295774869620264, 1.8767928093465083, 1.805961417295439, 3.523732007096139, 3.0810160842148373, 2.427555358135483, 3.4230370883425354, 2.876375939876421], Any[1.6411964430589048, 5.070249274762098, 2.2024804175879327, 1.795292970952936, 3.007106908479967, 2.4602280889464243, 2.6586977330882617, 4.675941487211586, 5.477129214735228, 2.9769986148619587  …  4.670118688582404, 2.9872588753388984, 3.072847166753498, 1.956053312628455, 1.919839539046275, 5.361905022367763, 4.484927323899354, 3.1018702034976884, 5.374237432541749, 4.07678274430113], Any[1.8475799862526583, 6.984669294600043, 2.633465575799345, 2.0792763175436413, 3.832144763935202, 3.1018180136823257, 3.5259146423525913, 6.492819370700827, 7.670011282369997, 3.837706351539337  …  6.231009662332437, 3.9361988612106167, 3.957090205095256, 2.2249572216792397, 2.3167039237782436, 7.0616857240667565, 6.044946788293139, 4.063304306017262, 7.466398840603036, 5.53489490741081], Any[2.308061845374321, 8.629531580158085, 3.3250963917455727, 2.6422344436822294, 4.880538797297522, 4.074239113553179, 4.807346980483108, 8.260623945217613, 8.994861890364627, 4.962236001819648  …  7.65075418159134, 5.207220989667916, 5.069111018030628, 2.7107815560318693, 3.0561337466036185, 8.3710522604099, 7.542372625738142, 5.302410033319807, 8.890217053932128, 7.075555407357648], Any[3.090766562487213, 9.448020646768704, 4.308050947503887, 3.5547270474522956, 6.100426036529349, 5.3752996340485675, 6.418488908549223, 9.28113563685247, 9.605143625887077, 6.282207576576384  …  8.861816701045639, 6.695480582173282, 6.332588371646612, 3.4576377559792495, 4.213733280645116, 9.331965299232323, 8.860777125189998, 6.729744208644265, 9.560965864029814, 8.522725049756254], Any[4.257067813204852, 9.78959777913004, 5.561073902843114, 4.857778863231036, 7.4011154754182975, 6.896909538448386, 8.117320603044135, 9.722957925133384, 9.851022435361147, 7.670943675600031  …  9.548870135241259, 8.224732588665066, 7.634792972093263, 4.493594842542596, 5.76635743721624, 9.743410899453908, 9.54838429427887, 8.180158741170189, 9.83388579508531, 9.40056594043293], Any[5.776957244959207, 9.921554002596567, 6.986664623578474, 6.479393138460385, 8.695970361283223, 8.455175937271884, 9.213842480788326, 9.896266435701012, 9.94467317924397, 8.99529730892908  …  9.8291676396249, 9.264374279676248, 8.885228072312414, 5.788165534447225, 7.508671655343514, 9.904050989415161, 9.828977826699095, 9.243506542947934, 9.938241517861718, 9.770798610574152], Any[7.4724281673371955, 9.97099742368964, 8.434311906649219, 8.178201220998341, 9.477207382570754, 9.370190620155618, 9.695674943051053, 9.961586645031627, 9.979574769623946, 9.605328084287757  …  9.93646823426861, 9.716185990985764, 9.558810290599393, 7.236241397891956, 8.912215110947397, 9.964486877419427, 9.936396919440869, 9.707727968641915, 9.97719124742893, 9.914442438715582], Any[8.893349198027845, 9.989310738571614, 9.36075620943755, 9.24258135726651, 9.801104856148482, 9.758700761137307, 9.885849493661295, 9.985834054797717, 9.992476189653981, 9.851094786645591  …  9.976533356871583, 9.893685880668023, 9.833046871432769, 8.704004320625046, 9.570282464041215, 9.986906023084689, 9.97650708072096, 9.890455504905525, 9.991596964465355, 9.96835381454459], Any[9.56226935047765, 9.996064968465781, 9.75494942050701, 9.707372661511167, 9.925899680641917, 9.909857578188026, 9.957700923396514, 9.994783830755834, 9.997230750206603, 9.944700379551358  …  9.991354067834736, 9.960624323856699, 9.937926560588206, 9.480740941655457, 9.837509100596893, 9.995178875602777, 9.991344372433726, 9.959419569525178, 9.996906966983246, 9.988334418626536]]))</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>After running <code>solve</code>, we get <code>sol</code>, a <a href="../API/#Mermaid.MermaidSolution">MermaidSolution</a> instance. This stores all variables given in <code>state_names</code> at each timepoint.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidSolution-tutorial" href="#Mermaid.MermaidSolution-tutorial"><code>Mermaid.MermaidSolution</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidSolution</code></pre><p>Struct for storing the solution of a hybrid Mermaid simulation.</p><p><strong>Fields</strong></p><ul><li><code>t::Vector</code>: Time points.</li><li><code>u::Dict</code>: Dictionary mapping variables to their solution arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/2e6cfcacec545c32055b6f7541a6bce78e25519d/src/types.jl#L129-L137">source</a></section></article><pre><code class="language-julia hljs">using Plots

plot(sol.t, sol[&quot;forest.life[1]&quot;], color=:green, label=&quot;Life&quot;)
plot!(sol.t, sol[&quot;forest.heat[1]&quot;], color=:red, label=&quot;Heat&quot;)</code></pre><img src="2a8f65bb.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/mtk/">ModelingToolkit »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 10:53">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
