<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Mermaid.jl</title><meta name="title" content="Tutorial · Mermaid.jl"/><meta property="og:title" content="Tutorial · Mermaid.jl"/><meta property="twitter:title" content="Tutorial · Mermaid.jl"/><meta name="description" content="Documentation for Mermaid.jl."/><meta property="og:description" content="Documentation for Mermaid.jl."/><meta property="twitter:description" content="Documentation for Mermaid.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mermaid.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Components"><span>Components</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li><li><a class="tocitem" href="#Solving-the-hybrid-model"><span>Solving the hybrid model</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li><li><a class="tocitem" href="#Advanced-Visualisations"><span>Advanced Visualisations</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/mtk/">ModelingToolkit</a></li></ul></li><li><a class="tocitem" href="../interface/">Mermaid Interface</a></li><li><a class="tocitem" href="../is_mermaid_right_for_me/">Is Mermaid right for me?</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will:</p><ul><li>Create a hybrid simulation between an Agent-based model, defined in Agents.jl, and an ODE system defined through DifferentialEquations.jl.</li><li>Introduce Mermaid Components for Agents.jl and DifferentialEquations.jl.</li><li>Demonstrate how these Components can be connected together through Connections.</li><li>Solve the hybrid model.</li><li>Visualise the results of the simulation.</li></ul><p>The example system we will use for this will be a model of a forest fire (governed by an Agent-based model), with the growth of each tree informed by an ODE model.</p><h2 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h2><p>To begin, we need to define our components. These will be an ODE model component for each tree, and an Agent-based model component for handling the forest level properties (in this case, the spread of heat/fire).</p><h3 id="ODE-Components"><a class="docs-heading-anchor" href="#ODE-Components">ODE Components</a><a id="ODE-Components-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Components" title="Permalink"></a></h3><p>To define the ODE model, let&#39;s have a look at how to define an ODE Component.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.ODEComponent-tutorial" href="#Mermaid.ODEComponent-tutorial"><code>Mermaid.ODEComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an ODE system, defined by an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">ODEProblem</a>.</p><p><strong>Fields</strong></p><ul><li><code>model::ODEProblem</code>: The ODE problem to be solved.</li><li><code>name::String=&quot;ODE Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping variable names (as strings) to their corresponding indices in the state vector or symbols from <a href="https://docs.sciml.ai/ModelingToolkit/stable/">ModelingToolkit</a>/<a href="https://docs.sciml.ai/Symbolics/stable/">Symbolics</a>.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ODE solver timestep), i.e. how frequently should the inputs and outputs be updated.</li><li><code>alg=Rodas5()</code>: The algorithm used for solving the ODEProblem.</li><li><code>intkwargs::Tuple=()</code>: Additional keyword arguments for the ODE solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/DiffEq.jl#L5-L16">source</a></section></article><p>We see that we need to define an <code>ODEProblem</code> to use in the component, so let&#39;s create one.</p><pre><code class="language-julia hljs">using DifferentialEquations
function tree!(du, u, p, t)
    x, y = u
    du[1] = 0
    du[2] = (y*(1-y/10.0)-x*y)/10
end
u0 = [4.0, 2.0]
tspan = (0.0, 150.0)
prob = ODEProblem(tree!, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#56b6c2">ODEProblem</span> with uType <span class="sgr38_2" style="color:#56b6c2">Vector{Float64}</span> and tType <span class="sgr38_2" style="color:#56b6c2">Float64</span>. In-place: <span class="sgr38_2" style="color:#56b6c2">true</span>
Non-trivial mass matrix: <span class="sgr38_2" style="color:#56b6c2">false</span>
timespan: (0.0, 150.0)
u0: 2-element Vector{Float64}:
 4.0
 2.0</code></pre><p>Next, we want to wrap this ODEProblem inside an ODEComponent. For this, we will need to define the <code>state_names</code> field, and should generally provide a value for the <code>name</code> field (since component names in a hybrid simulation should be unique).</p><pre><code class="language-julia hljs">using Mermaid
comp1 = ODEComponent(
    model=prob,
    name=&quot;tree&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 150.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ())</code></pre><h3 id="Duplicated-Components"><a class="docs-heading-anchor" href="#Duplicated-Components">Duplicated Components</a><a id="Duplicated-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Duplicated-Components" title="Permalink"></a></h3><p>Since the <code>ODEProblem</code> is defined for only a single tree, we can efficiently simulate the ODE by generating a duplicated component. This component stores a single <code>ODEProblem</code> will solve across many different states. In this case, we can have a state for each tree in the Agent-based model. Let&#39;s have a look at how to define a <a href="../API/#Mermaid.DuplicatedComponent">DuplicatedComponent</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.DuplicatedComponent-tutorial" href="#Mermaid.DuplicatedComponent-tutorial"><code>Mermaid.DuplicatedComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DuplicatedComponent &lt;: AbstractComponent</code></pre><p>Represents a component that is duplicated in the simulation, allowing a single component to have multiple states.</p><p><strong>Fields</strong></p><ul><li><code>component::AbstractTimeDependentComponent</code>: The original component to be duplicated.</li><li><code>instances::Union{Int,Nothing}</code>: Number of instances of the component. If <code>nothing</code>, then the number is variable and determined by the simulation.</li><li><code>name::String</code>: Name of the duplicated component.</li><li><code>initial_states::Vector</code>: Vector of states for the duplicated component, where each state corresponds to a particular instance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/Duplicated.jl#L3-L13">source</a></section></article><pre><code class="language-julia hljs">dup_comp = DuplicatedComponent(
    component=comp1,
    instances=640,
    initial_states=[copy(u0) for _ in 1:640]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DuplicatedComponent(ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 150.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ()), 640, &quot;tree&quot;, [[4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]  …  [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]], 1.0, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2))</code></pre><h3 id="Agents.jl-Components"><a class="docs-heading-anchor" href="#Agents.jl-Components">Agents.jl Components</a><a id="Agents.jl-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Agents.jl-Components" title="Permalink"></a></h3><p>Now that we have created our <a href="../API/#Mermaid.ODEComponent">ODEComponent</a>, we can move on to the <a href="../API/#Mermaid.AgentsComponent">AgentsComponent</a>, so let&#39;s have a look at its documentation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.AgentsComponent-tutorial" href="#Mermaid.AgentsComponent-tutorial"><code>Mermaid.AgentsComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AgentsComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an agent-based model (ABM) using the Agents.jl package.</p><p><strong>Fields</strong></p><ul><li><code>model::StandardABM</code>: The agent-based model to be solved.</li><li><code>name::String=&quot;Agents Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping ConnectedVariable names (as strings) to their corresponding properties in the agent model. The properties differentiate between <code>:model</code> properties and <code>:agent</code> properties.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ABM solver timestep), i.e. how frequently should the inputs and outputs be updated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/Agents.jl#L5-L15">source</a></section></article><p>We can see that, again, we need to define the model (this time a <code>StandardABM</code> from <code>Agents.jl</code>), a <code>name</code> and a <code>state_names</code>.</p><pre><code class="language-julia hljs">using Agents, Random, Statistics
@agent struct Tree(GridAgent{2})
    heat::Float64 # Heat is averaged across neighbors, passed to ODE model
    life::Float64 # Life is informed by ODE model
end

function forest_fire(; density=0.4, griddims=(40, 40), seed=2)
    space = GridSpaceSingle(griddims; periodic=false, metric=:chebyshev)
    rng = Random.MersenneTwister(seed)
    forest = StandardABM(Tree, space; rng, agent_step! = tree_step!)
    for _ in 1:floor(density * prod(griddims))
        # Randomly place trees in the grid
        add_agent_single!(forest; heat=rand(), life=rand())
    end
    return forest
end

function tree_step!(tree, forest)
    nearbyheat = mean([getproperty(neighbor, :heat) for neighbor in nearby_agents(tree, forest, 1)])
    if isnan(nearbyheat)
        nearbyheat = 0.0
    end
    tree.heat = tree.heat * 0.9 + nearbyheat * 0.1
    if rand(abmrng(forest)) &lt; 1e-4 # Random chance of fire
        tree.heat = 10.0
    end
    # Simulate tree life cycle
    if tree.heat &gt; 1.0 &amp;&amp; tree.life &gt; 1.0
        # Tree on fire
        tree.heat += 1.0
    else
        # Tree not on fire so heat disappates
        tree.heat -= 0.05
    end
    if tree.heat &lt; 0.0
        tree.heat = 0.0
    end
end

forest = forest_fire()

comp2 = AgentsComponent(
    model=forest,
    name=&quot;forest&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentsComponent(StandardABM with 640 agents of type Tree
 agents container: Dict
 space: GridSpaceSingle with size (40, 40), metric=chebyshev, periodic=false
 scheduler: fastest, &quot;forest&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life), 1.0)</code></pre><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p>We can now set up the connections between the variables in the two components.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.Connector-tutorial" href="#Mermaid.Connector-tutorial"><code>Mermaid.Connector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Connector</code></pre><p>Represents a connection between multiple <a href="../API/#Mermaid.ConnectedVariable">ConnectedVariables</a>, possibly with a transformation function.</p><p><strong>Fields</strong></p><ul><li><code>inputs::Vector{ConnectedVariable}</code>: Input variables for the connector.</li><li><code>outputs::Vector{ConnectedVariable}</code>: Output variables for the connector.</li><li><code>func::Union{Nothing,Function}</code>: Optional function to transform inputs to outputs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/types.jl#L36-L45">source</a></section></article><pre><code class="language-julia hljs">conn1 = Connector(inputs=[&quot;forest.heat[1:640]&quot;], outputs=[&quot;tree[1:640].heat&quot;])
conn2 = Connector(inputs=[&quot;tree[1:640].life&quot;], outputs=[&quot;forest.life[1:640]&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Connector(ConnectedVariable[ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, 1:640)], ConnectedVariable[ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, 1:640, nothing)], nothing)</code></pre><h2 id="Solving-the-hybrid-model"><a class="docs-heading-anchor" href="#Solving-the-hybrid-model">Solving the hybrid model</a><a id="Solving-the-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-hybrid-model" title="Permalink"></a></h2><p>To create the hybrid model, we need to create a <a href="../API/#Mermaid.MermaidProblem">MermaidProblem</a>. We can then solve this using the <code>CommonSolve</code> interface.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidProblem-tutorial" href="#Mermaid.MermaidProblem-tutorial"><code>Mermaid.MermaidProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidProblem</code></pre><p>Struct for defining a Mermaid problem. This struct contains the components, connectors and other properties of the hybrid simulation.</p><p><strong>Fields</strong></p><ul><li><code>components::Vector</code>: Vector of Components.</li><li><code>connectors::Vector{Connector}</code>: Vector of <a href="../API/#Mermaid.Connector">Connector</a>.</li><li><code>max_t::Float64</code>=1.0: Maximum simulation time.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/types.jl#L112-L122">source</a></section></article><pre><code class="language-julia hljs">mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2], max_t=tspan[2])
alg = MinimumTimeStepper()
sol = solve(mp, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MermaidSolution(Any[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0  …  141.0, 142.0, 143.0, 144.0, 145.0, 146.0, 147.0, 148.0, 149.0, 150.0], Dict{Any, Any}(ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[[0.8619056454071671, 0.9674323551974051, 0.989327587204651, 0.6305182712427475, 0.13769871473046957, 0.9425119884828685, 0.4836605010809182, 0.5792594453239635, 0.3232708166147592, 0.6151261454573128  …  0.4799279156549402, 0.24643661020142404, 0.5694627733914268, 0.9000446559060039, 0.04765239410015276, 0.37380738796795443, 0.32280073839647705, 0.9467902255887326, 0.031804645199206893, 0.49545052185447336], [2.1362867154708503, 1.9669738001081276, 2.018604611757004, 2.120290171096233, 2.0168495780523843, 2.1161253838287633, 1.9661578379597808, 2.102130579050856, 2.1291141644660505, 2.0441691051179935  …  2.0362470943759465, 2.102876283472366, 2.011678379188603, 2.1076101337434214, 2.032805180200427, 2.1638979397845293, 1.962236726472828, 2.1542252659595347, 2.0421810126423185, 2.092925135796688], [2.274595443011512, 1.9535286336403368, 2.050457743941929, 2.244893049855608, 2.044080047269202, 2.2433690411871714, 1.9572300136946108, 2.216979294815743, 2.278581578856968, 2.0980209637309146  …  2.0832632017452966, 2.21124182164707, 2.0424645833901525, 2.2300631122345083, 2.0810243335608716, 2.3321757417105133, 1.9457718008563016, 2.3214038205954233, 2.0947377861821153, 2.1966336862349682], [2.4164561493072108, 1.957568918807259, 2.0953730635600194, 2.3751470278660887, 2.081860129459417, 2.3834843100374776, 1.9699139679519226, 2.345779955509506, 2.449324887266675, 2.162159581441836  …  2.141450740644944, 2.3267437506555977, 2.0915996388613047, 2.368860928120257, 2.144859454903998, 2.5064900191619586, 1.948666826549668, 2.5034110930061475, 2.158329391658775, 2.3126019197789667], [2.5634781229458388, 1.9777390944246507, 2.153451653156207, 2.5124485280736795, 2.130519391147308, 2.538304834205895, 2.0021428259606937, 2.4898786419877457, 2.6389440306349923, 2.2373113053724185  …  2.211369972932278, 2.4510378149082124, 2.1588759636210915, 2.525665600083555, 2.2247470752858973, 2.688609254333475, 1.9697227231546033, 2.69572252434602, 2.233737452621212, 2.442401100009953], [2.7173280482874085, 2.013254896104862, 2.2250488598509603, 2.658249000155998, 2.1905429006861237, 2.709477727102928, 2.0527484346953306, 2.650671480891723, 2.837725905104772, 2.324330213658714  …  2.293737298841255, 2.585802795653503, 2.244547032044755, 2.702305314371121, 2.321329126521064, 2.8803834193599474, 2.008330910034492, 2.8970980432795685, 2.321875858145933, 2.5877124726037213], [2.8797176510413394, 2.0637896305022045, 2.310752460549675, 2.8140550340352863, 2.262569652426066, 2.8985837379762596, 2.121244879555547, 2.829671129201821, 3.0452867074792924, 2.4242044939382277  …  2.389426075186829, 2.7327560752471207, 2.34926640604526, 2.9007750450433414, 2.435461940527752, 3.0837234964524587, 2.06437422082667, 3.107117595065293, 2.4238003997911015, 2.750340502104516], [3.0523978048324043, 2.1293974251897443, 2.4113688022328446, 2.9814300714210797, 2.3473938343933485, 3.1068074735548064, 2.2076876215890957, 3.0284954687452963, 3.261116696103287, 2.538063295238147  …  2.4994690824132495, 2.893668417014633, 2.473740046354693, 3.1109444067131524, 2.56804708703033, 3.3005870632878413, 2.1381599771796043, 3.3252345202232783, 2.5407180204470774, 2.9320509236397405], [3.237156341129126, 2.2104617255878725, 2.527914359527934, 3.1619963024151914, 2.4459681161283475, 3.3249131297536496, 2.312581015203072, 3.2436904471197496, 3.484579107651439, 2.6671834376593524  …  2.6250617572829524, 3.0703763677633504, 2.618892530738374, 3.3292002205545117, 2.7201749425982706, 3.52533922512528, 2.2303753151222208, 3.550775488978168, 2.673995167655985, 3.134587996775736], [3.4358171613077855, 2.307661149868141, 2.661610602878621, 3.3574354102424215, 2.5594081622113305, 3.550443894851007, 2.436817010715889, 3.4665730180980843, 3.714912713828906, 2.812995169378206  …  2.7675649558678397, 3.264790840647533, 2.7858404718132603, 3.554866916009857, 2.893096334102778, 3.756813579557346, 2.342057675784256, 3.782944176084448, 2.824950220098962, 3.3536950682350914]  …  [0.011084275263104399, 9.999931290038434, 9.999946367629068, 3.971737314721961e-6, 9.99994078525391, 9.999966383031222, 9.999939981257915, 9.999965121964571, 9.999968690640756, 9.999950771921448  …  9.999949552390996, 9.99996166287742, 9.999951724852183, 7.558695993213632e-6, 9.999954220937708, 6.354710056682184e-14, 9.999935829997911, 9.999969586503386, 9.999951474188277, 1.1506651392001695e-10], [0.00603334721604024, 9.999937828615131, 9.999951471399193, 3.164217586943052e-6, 9.999946420251844, 9.999969582099038, 9.99994569276536, 9.999968441038002, 9.999971670111778, 9.999955456571639  …  9.999954353093806, 9.999965311124333, 9.999956318819827, 6.398925431018147e-6, 9.999958577373429, 5.999768031525018e-14, 9.999941936545536, 9.999972480722283, 9.999956092009535, 1.0741856206965369e-10], [0.00334418709429361, 9.999943744971356, 9.999956089485865, 2.5373301291499004e-6, 9.999951519014296, 9.999972476737062, 9.999950860756629, 9.999971444261732, 9.999974366050177, 9.999959695422202  …  9.999958696953314, 9.999968612196945, 9.999960475617284, 5.4662790970611595e-6, 9.999962519242748, 5.701056502021003e-14, 9.999947461984748, 9.999975099521283, 9.999960270390675, 1.0093168421533085e-10], [0.0018745599023847022, 9.999949098317881, 9.999960268107163, 2.0478729999023344e-6, 9.999956132569832, 9.999975095915303, 9.99995553695311, 9.999974161692496, 9.999976805437369, 9.999963530895903  …  9.999962627443189, 9.99997159913284, 9.999964236846141, 4.711247730972964e-6, 9.999966085996284, 5.4518984702027575e-14, 9.99995246161416, 9.99997746910979, 9.999964051149286, 9.545118432917748e-11], [0.0010562442121456917, 9.999953942231064, 9.999964049083077, 1.6635458099646592e-6, 9.999960307091179, 9.999977465846962, 9.99995976815443, 9.999976620526802, 9.999979012687204, 9.999967001378556  …  9.999966183900161, 9.999974301825741, 9.999967640149187, 4.096130469946518e-6, 9.999969313330539, 5.246877988915494e-14, 9.99995698547024, 9.999979613203104, 9.999967472123608, 9.085072620816961e-11], [0.0005994553590285205, 9.99995832518901, 9.999967470254026, 1.3600729180831891e-6, 9.999964084357298, 9.999979610250776, 9.999963596706793, 9.999978845373127, 9.999981009890282, 9.999970141603194  …  9.999969401917687, 9.99997674732467, 9.999970719587123, 3.592026904718361e-6, 9.999972233545126, 5.0816428233883176e-14, 9.999961078828022, 9.999981553259754, 9.999970567551198, 8.70274567854236e-11], [0.0003431901514559683, 9.999962291056669, 9.99997056585953, 1.1191155953737994e-6, 9.999967502171483, 9.999981550588377, 9.999967060926753, 9.999980858498187, 9.999982817035047, 9.999972982997651  …  9.999972313702141, 9.999978960104636, 9.99997350597943, 3.176639211467222e-6, 9.999974875866025, 4.952749544870101e-14, 9.999964782654198, 9.999983308696255, 9.99997336841156, 8.389814970942778e-11], [0.00019841811802044155, 9.999965879524833, 9.999973366880873, 9.267493842123457e-7, 9.999970594739656, 9.99998330627909, 9.99997019548467, 9.999982680049767, 9.999984452207814, 9.999975553999068  …  9.99997494839513, 9.99998096231159, 9.999976027212789, 2.8326560322403314e-6, 9.999977266738048, 4.8575432970608294e-14, 9.999968134017074, 9.999984897081417, 9.999975902736168, 8.13961653517747e-11], [0.00011594090445304165, 9.99996912650732, 9.999975901351144, 7.723482529932503e-7, 9.999973393012707, 9.999984894894274, 9.999973031751653, 9.999984328258366, 9.999985931773779, 9.99997788033849  …  9.999977332365127, 9.999982773984053, 9.999978308520168, 2.5465566981627114e-6, 9.9999794300895, 4.7940663291897104e-14, 9.999971166457541, 9.999986334312181, 9.99997819588901, 7.946907062306557e-11], [6.850547709489986e-5, 9.999972064500389, 9.99997819463579, 6.477628900169243e-7, 9.99997592499622, 9.999986332333169, 9.999975598113533, 9.99998581961965, 9.999987270540805, 9.999979985298376  …  9.999979489471361, 9.999984413253653, 9.999980372733342, 2.3077210372765663e-6, 9.99998138757165, 4.7609908680700454e-14, 9.99997391032473, 9.999987634772712, 9.999980270820414, 7.807673010902568e-11]], ConnectedVariable(&quot;forest&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[[0.13401743044430203, 0.9681709608155621, 0.7064750308422648, 0.20996566940269112, 0.7152608933666786, 0.2298325652400829, 0.972361295755008, 0.29687629035652574, 0.16800111568666376, 0.5793499342370938  …  0.6185742404634719, 0.29329274269499417, 0.7411926195536214, 0.2705732036113704, 0.6356634686205156, 0.004244080901450564, 0.9925221063666357, 0.04951778383495842, 0.5891793811193875, 0.3412181311389523], [0.15217210751776777, 0.872567108896215, 0.6399799225912293, 0.2107281895120635, 0.6628404092243004, 0.19814403565645816, 0.8493432752082741, 0.2521327552891585, 0.10120100411799739, 0.5328618635053431  …  0.5657547850691607, 0.2818379773614967, 0.645413351763723, 0.21839964723364108, 0.5598742871442529, 0.02636551928828676, 0.8888663949391074, 0.028882055780198854, 0.5390558975316888, 0.3019116022482157], [0.16049265132712381, 0.7837839054045996, 0.5760232825784036, 0.2050195322477975, 0.6105627277027272, 0.16285465540079996, 0.7390448544680752, 0.20717457703996206, 0.041080903706197644, 0.4858654201065539  …  0.5132873762518391, 0.26397298771155037, 0.5555786298839358, 0.16630372054197823, 0.48657276828976176, 0.03731878754367755, 0.79041014545177, 0.004015740988918624, 0.48829013182105746, 0.26009398126808025], [0.1604160211710821, 0.7007233655853421, 0.5141580739212726, 0.19367211583813188, 0.5583417668128808, 0.12462941791618494, 0.6391146919809041, 0.1620994177171966, 0.0, 0.4383610138368383  …  0.46107795171260363, 0.24072233772763052, 0.47089657049203576, 0.11437131746816588, 0.4158374033460672, 0.038905284396877585, 0.6966057394942418, 0.0, 0.43698766213849843, 0.21619970218681916], [0.1531597251912608, 0.6224652336093883, 0.45401242733574937, 0.17740376603874686, 0.5061138022835646, 0.08507228008523467, 0.5476416628474463, 0.11723165093308381, 0.0, 0.3903582291213754  …  0.40905152913257636, 0.21294493647633278, 0.3906805718803244, 0.06265651942633241, 0.3477452408260616, 0.03262235151682334, 0.6069851551045906, 0.0, 0.3852385466236849, 0.17060727664936182], [0.13975650167689269, 0.5482380732845558, 0.39527735844367595, 0.15683442645616041, 0.4538327389519588, 0.04499550402284146, 0.46307187148238144, 0.07256448341660135, 0.0, 0.34187342569301504  …  0.3571486936961245, 0.181360859490085, 0.3143352935026089, 0.011189575884141593, 0.2822182146955912, 0.01971594544823259, 0.5211365309054602, 0.0, 0.3331194939407934, 0.12363925752304909], [0.12108339158523039, 0.4773950796133924, 0.3376964573900073, 0.1325003222477173, 0.40146630490308716, 0.006064602610102866, 0.3841413664864112, 0.028101103463802804, 0.0, 0.29292780727688716  …  0.30532270518482646, 0.14657383237531063, 0.242597393198779, 0.0, 0.21976273218334563, 0.0012240472801066798, 0.4386970068012915, 0.0, 0.28069574702031075, 0.07615999633011393], [0.09788611302124349, 0.40939383795861983, 0.28105724944656035, 0.1048659996522071, 0.34899304660107056, 0.0, 0.3098215808484343, 0.0, 0.0, 0.24354590000937432  …  0.25353715288296375, 0.1090901001718838, 0.1752031850246325, 0.0, 0.16012360288356298, 0.0, 0.3593465121469646, 0.0, 0.2280227153551777, 0.028773671945127546], [0.07079951311477033, 0.3437793845277285, 0.2251839591538739, 0.07433458190932575, 0.29639995451423695, 0.0, 0.23927508554955618, 0.0, 0.0, 0.19375456366067784  …  0.20176508425297263, 0.06933429150740021, 0.11183090390319515, 0.0, 0.1030735157519027, 0.0, 0.2828023720200151, 0.0, 0.17591651182875073, 0.0], [0.040364749863117236, 0.2801700279575009, 0.1699314443914326, 0.04125658597307792, 0.24368215645715313, 0.0, 0.1718197023185597, 0.0, 0.0, 0.14358223445917584  …  0.14998718524213733, 0.027663740106571758, 0.05218450337335377, 0.0, 0.04904193380542905, 0.0, 0.2088560942704668, 0.0, 0.12452047986331559, 0.0]  …  [7.08144339702753, 0.0, 0.0, 3.272977632625674, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.6656854413883315, 0.0, 1.5747547209391888, 0.0, 0.0, 0.0, 1.6877734475238204], [6.900343034027926, 0.0, 0.0, 3.2079339597896714, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.5753186960206818, 0.0, 1.5106929817221748, 0.0, 0.0, 0.0, 1.6228910425549385], [6.788257431935745, 0.0, 0.0, 3.1431068598912, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.486453124990454, 0.0, 1.4468761772300458, 0.0, 0.0, 0.0, 1.5582893613290658], [6.7364155802740955, 0.0, 0.0, 3.0785032424493113, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.3991000012269628, 0.0, 1.383306602344631, 0.0, 0.0, 0.0, 1.493971696476006], [6.664463633976306, 0.0, 0.0, 3.0141302781285044, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.3132606151074167, 0.0, 1.3199863119823045, 0.0, 0.0, 0.0, 1.4299412419564996], [6.577333734862446, 0.0, 0.0, 2.94999578311129, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.228928207613083, 0.0, 1.2569171376384831, 0.0, 0.0, 0.0, 1.3662010439183496], [6.479065390619323, 0.0, 0.0, 2.8861081965271564, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.146089574776182, 0.0, 1.1941007030282318, 0.0, 0.0, 0.0, 1.302753965079908], [6.3729527288996, 0.0, 0.0, 2.8224761755822634, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 2.0647263977784487, 0.0, 1.1315384388257959, 0.0, 0.0, 0.0, 1.239602660027839], [6.261668260907432, 0.0, 0.0, 2.7591082857908225, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 1.9848163441060789, 0.0, 1.0692315965169343, 0.0, 0.0, 0.0, 1.176758346926428], [6.149190515791991, 0.0, 0.0, 2.696012768669142, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 1.9063339776933659, 0.0, 1.0071812613863171, 0.0, 0.0, 0.0, 1.1142381217161679]], ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[Any[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0  …  2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0], Any[2.0231216964688463, 2.0324802511779994, 1.9667529852269565, 2.1635397981170246, 1.9908556238011659, 2.0727254232403154, 2.152821807348004, 1.9744423410256156, 2.140553143369301, 2.1542148972738735  …  2.126473789259195, 2.1277458031520284, 2.033535018237249, 2.140866022822188, 1.978457075135599, 2.1294336550500947, 2.0943640636650227, 2.1161253838287633, 2.038065160353462, 2.068022005917101], Any[2.0590389961206466, 2.0787456061969016, 1.9521980586492693, 2.331341439777397, 2.0008403253618554, 2.1544632715797114, 2.318577095605344, 1.976148119143438, 2.291734748675927, 2.320861127260658  …  2.262667533570912, 2.258150707584021, 2.0765472084575807, 2.2917433668836953, 1.979681490144097, 2.261844875031412, 2.1951074602290572, 2.2433690411871714, 2.088511029713616, 2.152272154070108], Any[2.107666741009303, 2.13883777665024, 1.9544223054197674, 2.5051846562934608, 2.028510412584638, 2.24614106805346, 2.4987191237677675, 2.001894069512268, 2.455149062296907, 2.501331789446676  …  2.4100939761619293, 2.3927476133208785, 2.1297051323296614, 2.454294118308192, 2.001583736144966, 2.3989323922880788, 2.3033898621100195, 2.3834843100374776, 2.1518546874763476, 2.2533145418152594], Any[2.1691900002345728, 2.2130768546765975, 1.972192197752093, 2.686949960966373, 2.073058171319457, 2.348785884696202, 2.6907994927897727, 2.049764285723552, 2.6324545771446495, 2.693540881105475  …  2.570360632593975, 2.533143641479611, 2.1937546834037445, 2.6302630368740836, 2.042954097670258, 2.5424575112997703, 2.420451995278284, 2.538304834205895, 2.2288000416227827, 2.372028335672149], Any[2.2440316711698474, 2.302034176293816, 2.0048039255447545, 2.8785889650161818, 2.1341830605646424, 2.4635321684506457, 2.8919528576405407, 2.1188029212242263, 2.8253596434553088, 2.894818016303067  …  2.7450727523906875, 2.681005123828489, 2.2695338699791505, 2.821479292054735, 2.103268085559441, 2.694230465277669, 2.5476185798255235, 2.709477727102928, 2.320239981441471, 2.5095790040489625], Any[2.332832701384344, 2.406514400130807, 2.0519823053712622, 3.0821057391173077, 2.212004559449356, 2.591629346636212, 3.1017623000301486, 2.2087897266551595, 3.0323988917830866, 3.104744530040534  …  2.9358298374064393, 2.8380502925580853, 2.357988215462129, 3.028354213303122, 2.1825574077796315, 2.856105280813864, 2.6863027075991006, 2.8985837379762596, 2.4272603516618023, 2.6673936015910256], Any[2.436439415018237, 2.5275437594023575, 2.1138126686233525, 3.2993072799847254, 2.307003108001439, 2.7344484731209566, 3.3196843433803447, 2.3200927740629154, 3.247742021737565, 3.3227751728997554  …  3.144288775922108, 3.0060470515328985, 2.4601841233984416, 3.2435438243857786, 2.2813241085332976, 3.029979821321811, 2.8380107151953395, 3.1068074735548064, 2.5511402272327204, 2.847028332817956], Any[2.5558330080895666, 2.6663620104650847, 2.190693216890509, 3.524018136110719, 2.4199799205848844, 2.8934871669731956, 3.545048798200442, 2.4531391906453788, 3.470759974126529, 3.5482380059979737  …  3.3637417001002445, 3.1868134459131765, 2.5772399473497645, 3.4664214895667773, 2.4004830695044514, 3.2177981144126404, 3.0043464076694564, 3.3249131297536496, 2.693347946123979, 3.049785863229101], Any[2.6920847964211516, 2.8244158208440027, 2.2833019222600743, 3.755456060562621, 2.5520290959248286, 3.0703713265498767, 3.7770623397002856, 2.6083743262278962, 3.7006989587401207, 3.7803380327285088  …  3.590489543295059, 3.3822186838288864, 2.7102860371920663, 3.6962357614810695, 2.5410569743980753, 3.4215401178094162, 3.1870133776936242, 3.550443894851007, 2.855385301906301, 3.265784987680861]  …  Any[7.90659328074873, 9.999952067929183, 9.999929531456448, 9.99996922843784, 3.558789713590481, 3.0762993633030345e-7, 0.0002198730184761805, 9.999946955247296, 9.999968499309213, 9.98985604947209  …  7.845660997511879e-8, 9.999963504793657, 9.99994709434755, 9.99996843892649, 9.999944399719492, 3.111418141467321e-8, 9.999959965934028, 9.999966383031222, 9.99995294389164, 9.999961839806089], Any[8.03610097556843, 9.999956629249015, 9.999936237382236, 9.999972156730989, 2.336618543162753, 2.5091489440431946e-7, 0.00019475620225726674, 9.999952003098693, 9.999971496987737, 9.990820487874409  …  5.760449790971024e-8, 9.999966977760248, 9.999952128961937, 9.999971442351157, 9.999949690759122, 3.2004916845647745e-8, 9.999963775665309, 9.999969582099038, 9.99995742185334, 9.99996547121613], Any[8.17197457601834, 9.999960756505462, 9.999942305162563, 9.999974806361683, 1.4285396066675762, 2.057413602727509e-7, 0.00017354035515148433, 9.999956570587909, 9.999974209400982, 9.991693308321285  …  4.26050649941332e-8, 9.999970120232454, 9.999956684473783, 9.999974159963733, 9.999954478294583, 3.309855942634833e-8, 9.999967222855227, 9.999972476737062, 9.999961473684099, 9.99996875705409], Any[8.312010386663896, 9.999964491004466, 9.999947795523594, 9.99997720384789, 0.8154301183406621, 1.6959570270026822e-7, 0.00015553818144699435, 9.999960703426654, 9.999976663695245, 9.99248320035601  …  3.174095261040911e-8, 9.999972963660595, 9.99996080647494, 9.999976618962549, 9.999958810239761, 3.441230237355398e-8, 9.999970342003701, 9.999975095915303, 9.999965139935012, 9.999971730205086], Any[8.447708848365483, 9.999967870121305, 9.99995276341289, 9.99997937318411, 0.4837405089202538, 1.4054214776617766e-7, 0.00014019831078780206, 9.999964442976735, 9.999978884433565, 9.993198031860858  …  2.381821110281593e-8, 9.999975536502166, 9.99996453621875, 9.999978843957734, 9.999962729949088, 3.596741077053754e-8, 9.99997316432763, 9.999977465846962, 9.999968457298339, 9.99997442042488], Any[8.574369463257725, 9.999970927674628, 9.999957258549268, 9.9999813360815, 0.29675930550046087, 1.170838534039477e-7, 0.00012707601935499057, 9.999967826663989, 9.999980893841547, 9.993844926297614  …  1.8001386923000256e-8, 9.999977864506631, 9.99996791103291, 9.999980857217489, 9.999966276651401, 3.778977884425316e-8, 9.999975718073298, 9.999979610250776, 9.999971458974704, 9.99997685463766], Any[8.692294945450634, 9.999973694264895, 9.999961325920344, 9.999983112185175, 0.18756035145968997, 9.805868709857532e-8, 0.00011581075572030445, 9.9999708883528, 9.999982712029775, 9.994430332769426  …  1.3702133453835936e-8, 9.999979970973115, 9.999970964693, 9.999982678890943, 9.999969485842533, 3.991062628618192e-8, 9.999978028799061, 9.999981550588377, 9.999974175005349, 9.999979057205488], Any[8.801828944453309, 9.99997619758061, 9.999965006232738, 9.999984719270781, 0.12176471396393294, 8.256074216891782e-8, 0.00010610878471191511, 9.999973658685015, 9.999984357195085, 9.994960089556228  …  1.0503501785725886e-8, 9.999981876983574, 9.999973727760523, 9.999984327209818, 9.999972389640524, 4.2367359122982246e-8, 9.999980119631113, 9.99998330627909, 9.999976632572775, 9.99998105017211], Any[8.90334582966476, 9.999978462675413, 9.999968336319437, 9.999986173422416, 0.08099405065649656, 6.988101707488862e-8, 9.772970562009591e-5, 9.999976165386586, 9.999985845802682, 9.99543948171929  …  8.108164138659805e-9, 9.99998360161378, 9.999976227888721, 9.999985818670881, 9.999975017107056, 4.520462740022719e-8, 9.999982011494943, 9.999984894894274, 9.99997885627278, 9.999982853483568], Any[8.98924153438572, 9.999980512218833, 9.999971349508401, 9.999987489193591, 0.05478663813655513, 5.946241165371283e-8, 9.047592156307131e-5, 9.999978433545047, 9.99998719275092, 9.995873293318553  …  6.302788513729645e-9, 9.999985162124235, 9.999978490099341, 9.999987168201043, 9.999977394538277, 4.847562021453922e-8, 9.999983723324743, 9.999986332333169, 9.999980868360602, 9.99998448518781]], ConnectedVariable(&quot;tree&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[Any[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0  …  4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0], Any[0.683896931525845, 0.6372782373234913, 0.9693047747219472, 0.005916805416495752, 0.8462858137900477, 0.4392011310469819, 0.056103544121653526, 0.9298966648336386, 0.11385671279422893, 0.04956642349661933  …  0.18053989943970972, 0.17449734919070148, 0.6320373967223836, 0.11237979277143617, 0.9093816076046511, 0.16648494558738414, 0.33427418120274177, 0.2298325652400829, 0.6095590537420597, 0.46215215679758215], Any[0.6199145793081615, 0.5693615398804674, 0.8783357729429211, 0.028347453964828795, 0.750386488548183, 0.4018799163685334, 0.03475936711959461, 0.7938346475920024, 0.0959957745420107, 0.03119908458683608  …  0.1597951656441965, 0.18591502199035803, 0.5851875093290849, 0.09740336510538279, 0.7959060535613889, 0.17723099248235957, 0.3157374166994112, 0.19814403565645816, 0.5491680041735036, 0.3896834907592406], Any[0.5582441450934321, 0.5041450553377296, 0.7932815757994149, 0.039056655692532874, 0.6611861665259283, 0.36326448745360757, 0.01096562551883936, 0.671654284642611, 0.07393314598317373, 0.01011658337186351  …  0.13519777944197042, 0.18853266837039367, 0.5369191022788802, 0.07749512700932089, 0.6909074429296376, 0.1785716866113387, 0.2935893996733522, 0.16285465540079996, 0.4891989994415113, 0.3209591287030873], Any[0.4984379467744772, 0.44119988920214437, 0.7131570980853218, 0.040017447855172056, 0.5776904451609042, 0.3234233543376025, 0.0, 0.561108059682631, 0.048392934154433326, 0.0  …  0.10722527750486684, 0.18355590543334682, 0.4875212016125014, 0.053389771709025896, 0.5931920673533561, 0.1718970995202284, 0.26810915950878644, 0.12462941791618494, 0.42964347599380925, 0.2553291210394377], Any[0.4401435580586912, 0.3801632546193288, 0.6371437625108893, 0.0328533943937888, 0.499051649600842, 0.2824305886224302, 0.0, 0.46031405254406416, 0.019989572141861603, 0.0  …  0.07667173213039878, 0.17202341296703066, 0.4372436886664861, 0.025706639251289784, 0.501737907124755, 0.1583909756642874, 0.23957706242399796, 0.08507228008523467, 0.3704885266293346, 0.19226042463645293], Any[0.38307677094837006, 0.32072834925738514, 0.564561449277471, 0.018902445488259464, 0.4245476245722395, 0.24036297205991752, 0.0, 0.367700721408847, 0.0, 0.0  …  0.04419078248407511, 0.15483032358443632, 0.38629164795090926, 0.0, 0.41566955944722656, 0.139061637451795, 0.20826737839067416, 0.04499550402284146, 0.3117182952409767, 0.13132948726192956], Any[0.3270089584053855, 0.26263578603672544, 0.49484516843953835, 0.0, 0.35356320399582836, 0.197298349368081, 0.0, 0.2819560404817977, 0.0, 0.0  …  0.01008474486730885, 0.13274829794893472, 0.33483310343047673, 0.0, 0.3342368653372133, 0.11476820328681671, 0.17444322184215316, 0.006064602610102866, 0.2533335308732035, 0.07259575938129846], Any[0.2720043068560704, 0.20566636965191532, 0.42753618235872765, 0.0, 0.2855744451889634, 0.1533143851357302, 0.0, 0.2037604364336179, 0.0, 0.0  …  0.0, 0.10644276033433096, 0.28332112679309995, 0.0, 0.25679723151051986, 0.08624283993513586, 0.13835372094866677, 0.0, 0.1953627791073801, 0.017269524812475137], Any[0.21825619377841282, 0.14963526200434207, 0.36226917636685363, 0.0, 0.2201354210034241, 0.10848958086176906, 0.0, 0.1333843927902561, 0.0, 0.0  …  0.0, 0.07648770131773823, 0.23229880143706977, 0.0, 0.18385942272343092, 0.05414630365046939, 0.1002328362187943, 0.0, 0.13838695043877436, 0.0]  …  Any[0.06096774641877124, 0.0, 0.0, 0.0, 4.032596460069428, 3.0907086031146314, 2.2741753859312492, 0.0, 0.0, 0.0  …  4.163198295973189, 0.0, 0.0, 0.0, 0.0, 0.7719965332159422, 0.0, 0.0, 0.0, 0.0], Any[0.040326708636405764, 0.0, 0.0, 0.0, 4.916971249216552, 3.0378374011116533, 2.2129958899244193, 0.0, 0.0, 0.0  …  4.089451160100388, 0.0, 0.0, 0.0, 0.0, 0.7177416655384347, 0.0, 0.0, 0.0, 0.0], Any[0.021857910929718602, 0.0, 0.0, 0.0, 5.736135640330692, 2.984939687300829, 2.1533652531505734, 0.0, 0.0, 0.0  …  4.016275424660846, 0.0, 0.0, 0.0, 0.0, 0.6639978252430938, 0.0, 0.0, 0.0, 0.0], Any[0.005815023170057616, 0.0, 0.0, 0.0, 6.497660905848396, 2.932024608634363, 2.095172818750573, 0.0, 0.0, 0.0  …  3.943654429232412, 0.0, 0.0, 0.0, 0.0, 0.6107563165178629, 0.0, 0.0, 0.0, 0.0], Any[0.0, 0.0, 0.0, 0.0, 6.158182344664741, 2.879099577623907, 2.0383183809725973, 0.0, 0.0, 0.0  …  3.8715729113110138, 0.0, 0.0, 0.0, 0.0, 0.5580085514260202, 0.0, 0.0, 0.0, 0.0], Any[0.0, 0.0, 0.0, 0.0, 5.848020218811181, 2.8261705444991034, 1.9827110570401778, 0.0, 0.0, 0.0  …  3.8000167502049362, 0.0, 0.0, 0.0, 0.0, 0.5057460660726797, 0.0, 0.0, 0.0, 0.0], Any[0.0, 0.0, 0.0, 0.0, 5.564414621328601, 2.773242268332455, 1.928268287555498, 0.0, 0.0, 0.0  …  3.728972768178075, 0.0, 0.0, 0.0, 0.0, 0.45396053327803637, 0.0, 0.0, 0.0, 0.0], Any[0.0, 0.0, 0.0, 0.0, 5.304874600430416, 2.7203185652960302, 1.8749149510155048, 0.0, 0.0, 0.0  …  3.6584285765344267, 0.0, 0.0, 0.0, 0.0, 0.40264377231265386, 0.0, 0.0, 0.0, 0.0], Any[0.0, 0.0, 0.0, 0.0, 5.067151792960696, 2.6674025162321775, 1.8225825794936503, 0.0, 0.0, 0.0  …  3.588372456819502, 0.0, 0.0, 0.0, 0.0, 0.35178775616812225, 0.0, 0.0, 0.0, 0.0], Any[0.009300118588931407, 0.0, 0.0, 0.0, 4.9025916013660265, 2.6144966391848445, 1.7712086638995928, 0.0, 0.0, 0.0  …  3.5187932693218276, 0.0, 0.0, 0.0, 0.0, 0.301384616766173, 0.0, 0.0, 0.0, 0.0]]))</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>After running <code>solve</code>, we get <code>sol</code>, a <a href="../API/#Mermaid.MermaidSolution">MermaidSolution</a> instance. This stores all variables given in <code>state_names</code> at each timepoint.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidSolution-tutorial" href="#Mermaid.MermaidSolution-tutorial"><code>Mermaid.MermaidSolution</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidSolution</code></pre><p>Struct for storing the solution of a hybrid Mermaid simulation.</p><p><strong>Fields</strong></p><ul><li><code>t::Vector</code>: Time points.</li><li><code>u::Dict</code>: Dictionary mapping variables to their solution arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/afa09d8e67d70cd437001244221e33e6b4811351/src/types.jl#L129-L137">source</a></section></article><pre><code class="language-julia hljs">using Plots

plot(sol.t, sol[&quot;forest.life[1]&quot;], color=:green, label=&quot;Life&quot;)
plot!(sol.t, sol[&quot;forest.heat[1]&quot;], color=:red, label=&quot;Heat&quot;)</code></pre><img src="c79ca472.svg" alt="Example block output"/><h2 id="Advanced-Visualisations"><a class="docs-heading-anchor" href="#Advanced-Visualisations">Advanced Visualisations</a><a id="Advanced-Visualisations-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Visualisations" title="Permalink"></a></h2><p>While we can plot the variables from the ODE component easily, the Agent-based model is a bit more challenging. But default, we only store the variables given in state_names in the solution. This can be changed by providing <code>save_vars=[&quot;forest.#model&quot;]</code> to <code>solve</code>, in which case the full Agent-based model state will be visable in the solution at all timepoints. However, this can be wasteful if we know we only want an animation of the model (which can be generated during simulation).</p><p>We will set up a <a href="../API/#Mermaid.Connector">Connector</a> which takes an input of the model&#39;s current state, and instead of a transformation, we will use a function which adds the current state to a video.</p><pre><code class="language-julia hljs">using Makie
using CairoMakie

groupcolor(tree) = tree.heat &gt; 1 ? :red : :green
groupmarker(a) = a.life &gt; 1 ? :utriangle : :circle
fig, ax = abmplot(forest; agent_color=groupcolor, agent_marker=groupmarker, agent_size=10)
io = VideoStream(fig)
function plot_input(model)
    empty!(ax)
    abmplot!(ax, model; agent_color=groupcolor, agent_marker=groupmarker, agent_size=10)
    recordframe!(io)
end

conn3 = Connector(
    inputs=[&quot;forest.#model&quot;],
    outputs=Vector{String}(),
    func=(model) -&gt; plot_input(model)
)

mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2, conn3], max_t=tspan[2])
sol = solve(mp, alg)

save(&quot;forest_fire.mp4&quot;, io)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;forest_fire.mp4&quot;</code></pre><p><video src="../forest_fire.mp4" controls="true" title="An animation of the forest fire simulation"><a href="../forest_fire.mp4">An animation of the forest fire simulation</a></video></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/mtk/">ModelingToolkit »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Thursday 26 June 2025 09:59">Thursday 26 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
