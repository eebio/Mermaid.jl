<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Mermaid.jl</title><meta name="title" content="Tutorial · Mermaid.jl"/><meta property="og:title" content="Tutorial · Mermaid.jl"/><meta property="twitter:title" content="Tutorial · Mermaid.jl"/><meta name="description" content="Documentation for Mermaid.jl."/><meta property="og:description" content="Documentation for Mermaid.jl."/><meta property="twitter:description" content="Documentation for Mermaid.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mermaid.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Components"><span>Components</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li><li><a class="tocitem" href="#Solving-the-hybrid-model"><span>Solving the hybrid model</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/mtk/">ModelingToolkit</a></li></ul></li><li><a class="tocitem" href="../interface/">Mermaid Interface</a></li><li><a class="tocitem" href="../is_mermaid_right_for_me/">Is Mermaid right for me?</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will:</p><ul><li>Create a hybrid simulation between an Agent-based model, defined in Agents.jl, and an ODE system defined through DifferentialEquations.jl.</li><li>Introduce Mermaid Components for Agents.jl and DifferentialEquations.jl.</li><li>Demonstrate how these Components can be connected together through Connections.</li><li>Solve the hybrid model.</li><li>Visualise the results of the simulation.</li></ul><p>The example system we will use for this will be a model of a forest fire (governed by an Agent-based model), with the growth of each tree informed by an ODE model.</p><h2 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h2><p>To begin, we need to define our components. These will be an ODE model component for each tree, and an Agent-based model component for handling the forest level properties (in this case, the spread of heat/fire).</p><h3 id="ODE-Components"><a class="docs-heading-anchor" href="#ODE-Components">ODE Components</a><a id="ODE-Components-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Components" title="Permalink"></a></h3><p>To define the ODE model, let&#39;s have a look at how to define an ODE Component.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.ODEComponent-tutorial" href="#Mermaid.ODEComponent-tutorial"><code>Mermaid.ODEComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an ODE system, defined by an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">ODEProblem</a>.</p><p><strong>Fields</strong></p><ul><li><code>model::ODEProblem</code>: The ODE problem to be solved.</li><li><code>name::String=&quot;ODE Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping variable names (as strings) to their corresponding indices in the state vector or symbols from <a href="https://docs.sciml.ai/ModelingToolkit/stable/">ModelingToolkit</a>/<a href="https://docs.sciml.ai/Symbolics/stable/">Symbolics</a>.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ODE solver timestep), i.e. how frequently should the inputs and outputs be updated.</li><li><code>alg=Rodas5()</code>: The algorithm used for solving the ODEProblem.</li><li><code>intkwargs::Tuple=()</code>: Additional keyword arguments for the ODE solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/DiffEq.jl#L5-L16">source</a></section></article><p>We see that we need to define an <code>ODEProblem</code> to use in the component, so let&#39;s create one.</p><pre><code class="language-julia hljs">using DifferentialEquations
function tree!(du, u, p, t)
    x, y = u
    du[1] = 0
    du[2] = y*(1-y/10.0)-x*y
end
u0 = [4.0, 2.0]
tspan = (0.0, 10.0)
prob = ODEProblem(tree!, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#56b6c2">ODEProblem</span> with uType <span class="sgr38_2" style="color:#56b6c2">Vector{Float64}</span> and tType <span class="sgr38_2" style="color:#56b6c2">Float64</span>. In-place: <span class="sgr38_2" style="color:#56b6c2">true</span>
Non-trivial mass matrix: <span class="sgr38_2" style="color:#56b6c2">false</span>
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 4.0
 2.0</code></pre><p>Next, we want to wrap this ODEProblem inside an ODEComponent. For this, we will need to define the <code>state_names</code> field, and should generally provide a value for the <code>name</code> field (since component names in a hybrid simulation should be unique).</p><pre><code class="language-julia hljs">using Mermaid
comp1 = ODEComponent(
    model=prob,
    name=&quot;tree&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ())</code></pre><h3 id="Duplicated-Components"><a class="docs-heading-anchor" href="#Duplicated-Components">Duplicated Components</a><a id="Duplicated-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Duplicated-Components" title="Permalink"></a></h3><p>Since the <code>ODEProblem</code> is defined for only a single tree, we can efficiently simulate the ODE by generating a duplicated component. This component stores a single <code>ODEProblem</code> will solve across many different states. In this case, we can have a state for each tree in the Agent-based model. Let&#39;s have a look at how to define a <a href="../API/#Mermaid.DuplicatedComponent">DuplicatedComponent</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.DuplicatedComponent-tutorial" href="#Mermaid.DuplicatedComponent-tutorial"><code>Mermaid.DuplicatedComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DuplicatedComponent &lt;: AbstractComponent</code></pre><p>Represents a component that is duplicated in the simulation, allowing a single component to have multiple states.</p><p><strong>Fields</strong></p><ul><li><code>component::AbstractTimeDependentComponent</code>: The original component to be duplicated.</li><li><code>instances::Union{Int,Nothing}</code>: Number of instances of the component. If <code>nothing</code>, then the number is variable and determined by the simulation.</li><li><code>name::String</code>: Name of the duplicated component.</li><li><code>initial_states::Vector</code>: Vector of states for the duplicated component, where each state corresponds to a particular instance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/Duplicated.jl#L3-L13">source</a></section></article><pre><code class="language-julia hljs">dup_comp = DuplicatedComponent(
    component=comp1,
    instances=640,
    initial_states=[copy(u0) for _ in 1:640]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DuplicatedComponent(ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ()), 640, &quot;tree&quot;, [[4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]  …  [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]], 1.0, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2))</code></pre><h3 id="Agents.jl-Components"><a class="docs-heading-anchor" href="#Agents.jl-Components">Agents.jl Components</a><a id="Agents.jl-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Agents.jl-Components" title="Permalink"></a></h3><p>Now that we have created our <a href="../API/#Mermaid.ODEComponent">ODEComponent</a>, we can move on to the <a href="../API/#Mermaid.AgentsComponent">AgentsComponent</a>, so let&#39;s have a look at its documentation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.AgentsComponent-tutorial" href="#Mermaid.AgentsComponent-tutorial"><code>Mermaid.AgentsComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AgentsComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an agent-based model (ABM) using the Agents.jl package.</p><p><strong>Fields</strong></p><ul><li><code>model::StandardABM</code>: The agent-based model to be solved.</li><li><code>name::String=&quot;Agents Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping ConnectedVariable names (as strings) to their corresponding properties in the agent model. The properties differentiate between <code>:model</code> properties and <code>:agent</code> properties.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ABM solver timestep), i.e. how frequently should the inputs and outputs be updated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/Agents.jl#L5-L15">source</a></section></article><p>We can see that, again, we need to define the model (this time a <code>StandardABM</code> from <code>Agents.jl</code>), a <code>name</code> and a <code>state_names</code>.</p><pre><code class="language-julia hljs">using Agents, Random, Statistics
@agent struct Tree(GridAgent{2})
    heat::Float64 # Heat is averaged across neighbors, passed to ODE model
    life::Float64 # Life is informed by ODE model
end

function forest_fire(; density=0.4, griddims=(40, 40), seed=2)
    space = GridSpaceSingle(griddims; periodic=false, metric=:chebyshev)
    rng = Random.MersenneTwister(seed)
    forest = StandardABM(Tree, space; rng, agent_step! = tree_step!)
    for _ in 1:floor(density * prod(griddims))
        # Randomly place trees in the grid
        add_agent_single!(forest; heat=rand(), life=rand())
    end
    return forest
end

function tree_step!(tree, forest)
    nearbyheat = mean([getproperty(neighbor, :heat) for neighbor in nearby_agents(tree, forest, 1)])
    if isnan(nearbyheat)
        nearbyheat = 0.0
    end
    tree.heat = tree.heat * 0.9 + nearbyheat * 0.1
    if rand(abmrng(forest)) &lt; 1e-4 # Random chance of fire
        tree.heat = 10.0
    end
    # Simulate tree life cycle
    if tree.heat &gt; 1.0 &amp;&amp; tree.life &gt; 0
        # Tree on fire
        tree.heat += 1.0
    else
        # Tree not on fire so heat disappates
        tree.heat -= 0.1
    end
    if tree.heat &lt; 0.0
        tree.heat = 0.0
    end
end

forest = forest_fire()

comp2 = AgentsComponent(
    model=forest,
    name=&quot;forest&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentsComponent(StandardABM with 640 agents of type Tree
 agents container: Dict
 space: GridSpaceSingle with size (40, 40), metric=chebyshev, periodic=false
 scheduler: fastest, &quot;forest&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life), 1.0)</code></pre><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p>We can now set up the connections between the variables in the two components.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.Connector-tutorial" href="#Mermaid.Connector-tutorial"><code>Mermaid.Connector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Connector</code></pre><p>Represents a connection between multiple <a href="../API/#Mermaid.ConnectedVariable">ConnectedVariables</a>, possibly with a transformation function.</p><p><strong>Fields</strong></p><ul><li><code>inputs::Vector{ConnectedVariable}</code>: Input variables for the connector.</li><li><code>outputs::Vector{ConnectedVariable}</code>: Output variables for the connector.</li><li><code>func::Union{Nothing,Function}</code>: Optional function to transform inputs to outputs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/types.jl#L36-L45">source</a></section></article><pre><code class="language-julia hljs">conn1 = Connector(inputs=[&quot;forest.heat[1:640]&quot;], outputs=[&quot;tree[1:640].heat&quot;])
conn2 = Connector(inputs=[&quot;tree[1:640].life&quot;], outputs=[&quot;forest.life[1:640]&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Connector(ConnectedVariable[ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, 1:640)], ConnectedVariable[ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, 1:640, nothing)], nothing)</code></pre><h2 id="Solving-the-hybrid-model"><a class="docs-heading-anchor" href="#Solving-the-hybrid-model">Solving the hybrid model</a><a id="Solving-the-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-hybrid-model" title="Permalink"></a></h2><p>To create the hybrid model, we need to create a <a href="../API/#Mermaid.MermaidProblem">MermaidProblem</a>. We can then solve this using the <code>CommonSolve</code> interface.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidProblem-tutorial" href="#Mermaid.MermaidProblem-tutorial"><code>Mermaid.MermaidProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidProblem</code></pre><p>Struct for defining a Mermaid problem. This struct contains the components, connectors and other properties of the hybrid simulation.</p><p><strong>Fields</strong></p><ul><li><code>components::Vector</code>: Vector of Components.</li><li><code>connectors::Vector{Connector}</code>: Vector of <a href="../API/#Mermaid.Connector">Connector</a>.</li><li><code>max_t::Float64</code>=1.0: Maximum simulation time.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/types.jl#L112-L122">source</a></section></article><pre><code class="language-julia hljs">mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2], max_t=10.0)
alg = MinimumTimeStepper()
sol = solve(mp, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MermaidSolution(Any[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0], Dict{Any, Any}(ConnectedVariable(&quot;forest&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[[0.08032267697468076, 0.08427116077830754, 0.961353535821596, 0.8663452217260796, 0.6756174005421665, 0.2752344534103186, 0.16313062742021645, 0.211883263732227, 0.7716688886817227, 0.6616937476250988  …  0.15898215408708705, 0.8666209519854106, 0.1850766304873558, 0.7324553287443716, 0.3499156063832304, 0.32057376327592213, 0.7781142783593143, 0.29181065358859937, 0.12245166336487212, 0.9106360417549716], [0.02631691816158377, 0.04987511116031082, 0.8150575915269729, 0.7203474602307757, 0.5615724534654847, 0.1820826533454926, 0.1463236637839456, 0.16583282652469336, 0.5945019998135505, 0.5329742112735399  …  0.07466173403911316, 0.7416317867563111, 0.10782428812687359, 0.5972498159021887, 0.2622023572037303, 0.20736960159659537, 0.6337884505730964, 0.2124824811837003, 0.03797915161255125, 0.7662509359743565], [0.0, 0.0035580365047622603, 0.6741333012282392, 0.5795181552482609, 0.4488029953392202, 0.08842757162349513, 0.11441057909596172, 0.11130076738391556, 0.43505179983219544, 0.4076210122485171  …  0.0, 0.6182115923697895, 0.0260372823624887, 0.4684171236323904, 0.17205038608748, 0.09591901940371009, 0.4973638366408023, 0.131568856001491, 0.0, 0.6268965596810562], [0.0, 0.0, 0.537856277108146, 0.44318572899310527, 0.3371537988398172, 0.0, 0.07009148077035074, 0.04949146587823269, 0.2915466198489759, 0.285664126175153  …  0.0, 0.49636420571586626, 0.0, 0.3458591432757939, 0.0809521585166382, 0.0, 0.36826090599822914, 0.049553514645956254, 0.0, 0.49288389531659316], [0.0, 0.0, 0.4063997205760469, 0.31226729979397905, 0.22653065744085613, 0.0, 0.015570461371096217, 0.0, 0.1623919578640783, 0.16834884716054524  …  0.0, 0.37608926370774853, 0.0, 0.22911548907157672, 0.0, 0.0, 0.24595144874627897, 0.0, 0.0, 0.36384556982612903], [0.0, 0.0, 0.2804794575718952, 0.1902379560308934, 0.11916331394797383, 0.0, 0.0, 0.0, 0.04615276207767047, 0.056651480337829685  …  0.0, 0.2573836181143152, 0.0, 0.11783476299812395, 0.0, 0.0, 0.130046047827572, 0.0, 0.0, 0.23951796449948523], [0.0, 0.0, 0.1611418493037425, 0.07651005009845893, 0.01683324006932979, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.14024236429477943, 0.0, 0.011813614156141267, 0.0, 0.0, 0.020196327979157408, 0.0, 0.0, 0.12051265671123881], [0.0, 0.0, 0.04837251532923181, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.026218127865301477, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.008461391040114924], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], ConnectedVariable(&quot;tree&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[Any[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0  …  4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0], Any[0.16038033804912344, 0.12865473021486862, 0.1890304323462213, 0.8642780739723377, 0.4065003795504697, 0.2802891670141139, 0.5712279919338143, 0.012095588117184808, 0.8534385159556768, 0.9176737667800482  …  0.9266254590487695, 0.23012728812787053, 0.47385807469867014, 0.6626610326805877, 0.3448394629023599, 0.4638418214671588, 0.8758831575681972, 0.2752344534103186, 0.9977811498402444, 0.7002837025581982], Any[0.09259825353123272, 0.06186206976948605, 0.12891614833964046, 0.7420705337296353, 0.30940412663992634, 0.1892946346169054, 0.4554267388321559, 0.0, 0.7012548175813438, 0.7748610438873982  …  0.7960812867345255, 0.16763043514947876, 0.35820871911913776, 0.5617393195867474, 0.29667398117705435, 0.32648884677422985, 0.7547652846889131, 0.1820826533454926, 0.8366554595360524, 0.5806183378821236], Any[0.020129155903263335, 0.0, 0.06114439166247734, 0.6223195351120383, 0.21233734517014494, 0.0973310494491213, 0.34330279281982135, 0.0, 0.5571067173092354, 0.636907394865889  …  0.6683745574176218, 0.10027723704894623, 0.24513422115874992, 0.45939322044669995, 0.23969497234940643, 0.19484363743853253, 0.6352181928009693, 0.08842757162349513, 0.6823113854438344, 0.463839060222519], Any[4.65747192453536e-16, -1.6316794738202395e-16, -1.749845372539179e-15, 0.5046346243128775, 0.1161463510218605, 0.005648261442014814, 0.23613289830849468, 1.3635720313497297e-16, 0.4220398336536624, 0.5042824619128902  …  0.5432076954131098, 0.028649637296172786, 0.13555193199264223, 0.35585607726121404, 0.17520514604312817, 0.07535927369467926, 0.5170737871057371, 0.0, 0.5338946819144693, 0.34942065299139957], Any[-1.8349566352690125e-16, 2.339143627673033e-16, 1.4855264546090249e-19, 0.38869190483854077, 0.020979947927558827, -2.8627719265487317e-16, 0.13353756291953803, -1.0102896420013832e-19, 0.2951446919740689, 0.3767352923014894  …  0.42035908883784123, -5.289270799660301e-16, 0.030315128248674134, 0.2514011679801995, 0.10431754523311756, -4.908599409331056e-16, 0.40018562077199404, -7.210680317006687e-16, 0.39070248604858904, 0.23692828026561005], Any[-9.633150562430653e-17, 1.1461730734904673e-16, 2.3197522312435558e-17, 0.2742221545100131, -1.504820970913964e-16, -6.44344503311357e-17, 0.03516739393007376, 5.469023065142439e-17, 0.1756211069277078, 0.2538677055220835  …  0.29967174604980384, 2.2883512815126106e-16, 0.0, 0.14639018148002247, 0.028032875891162712, -8.176116614002931e-17, 0.2844379693694259, 1.0295029851048185e-16, 0.25233121423572535, 0.12602302315279032], Any[2.452034802687209e-17, -1.5256213725817966e-17, 1.6243817220349068e-17, 0.16100112394502233, -1.4399958634980315e-21, -4.510982700549587e-17, -5.235436418103037e-16, 2.6964507354409665e-17, 0.06385279525387902, 0.13724625138343982  …  0.181014232799125, -6.719297706362604e-17, 1.3799183037072495e-16, 0.04114148774712986, -2.9112586929039547e-16, 0.0, 0.17169877974521938, 2.1856783986772628e-17, 0.1270980928121528, 0.016764436181684925], Any[1.3630386840382052e-21, -2.2903068338440954e-18, -1.1631599131864207e-17, 0.048841609668384994, 7.106591252250796e-17, -1.1660441962932456e-17, 3.907316839912586e-20, -4.036665389758836e-18, 2.3765298743561966e-16, 0.026811079502066543  …  0.06771559083430147, -4.6668927148944446e-17, -6.43613376054122e-17, -3.87237302029577e-20, 4.018453392062045e-18, -3.267912670863755e-17, 0.06427432599440483, 9.710360097999948e-19, 0.014388283530937532, 1.5800459443036937e-16], Any[0.0, -2.63353716799478e-18, 3.5167469119347665e-18, -5.25595413170136e-16, 2.2250582318097446e-17, -1.5370800755753607e-17, -7.09146979569489e-17, -1.1874649501728963e-21, 5.35562273774736e-17, 0.0  …  -2.4054779785381554e-16, -2.2401516483281983e-18, 9.84808148636371e-19, -2.278507540385928e-16, 7.27655678848435e-18, 1.1635639189388028e-17, -6.285989495806147e-16, 2.019160338156038e-18, -5.1670383627286355e-16, -2.5159602265337084e-16], Any[3.9856983032151114e-18, 2.2403756153527943e-19, 1.8187635157388994e-18, 6.15718387120518e-17, -5.555386905774572e-18, 1.865857089545281e-21, 1.0941520568871518e-20, 5.039023708337456e-19, 0.0, -1.008532374943766e-19  …  2.4470753041054184e-16, 1.1961823882229542e-19, 7.561926986191805e-18, -1.2437404788682536e-17, -6.304819334081105e-18, 1.158440233515121e-17, -8.447407403363635e-18, -1.1875671779848936e-19, -2.2966062385079335e-16, -2.373927690399399e-17]], ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[[0.42634201014293394, 0.6392279201260854, 0.9523184128603782, 0.012859163461743317, 0.6846048035533843, 0.6812554092318631, 0.6780286496560957, 0.5113231742828065, 0.5561884487936871, 0.28496349057716397  …  0.675921564031099, 0.5136898636749696, 0.8049897865384327, 0.6437063690860318, 0.503444379410878, 0.06995088625433099, 0.5396520091372924, 0.6196187804851954, 0.7369289758737471, 0.7345355241174337], [3.7776903967938926, 3.7649071780297163, 1.7267051563257776, 1.8830572475169387, 2.2376975076715238, 3.1912791561278744, 3.5176967543775315, 3.3722113235327233, 2.0519753353438825, 2.2658798994569094  …  3.5302971963807157, 1.882584819246294, 3.4515151662079977, 2.1259943669924515, 2.9892740129272455, 3.0672150790009867, 2.040041331847036, 3.145403418848227, 3.6433484226537662, 1.8085857435762345], [6.101588134336564, 5.9787289158590715, 1.746270254778293, 2.0461029536072592, 2.708376918762877, 4.840353314699392, 5.310256995598501, 5.086659316712788, 2.456469180082945, 2.8046566386353367  …  5.633626440764671, 2.006559708914323, 5.409046332026497, 2.520507243919416, 4.334838813435869, 4.616123439449599, 2.3606750559138563, 4.6760626903258915, 5.913356962891305, 1.8981075226865398], [8.096932162405382, 7.996391502054737, 2.005063313206333, 2.4838326080958426, 3.4524934283483457, 6.727698956994133, 6.943616937171032, 6.798456064536216, 3.2490426845032596, 3.6679464431303614  …  7.781826833411815, 2.362230947522048, 7.478855124462528, 3.218304728121039, 5.924028077526935, 6.513006569309835, 2.9863812020694462, 6.3870292315524635, 7.973001708988147, 2.240931739834732], [9.204166644396818, 9.15608841303099, 2.536481228964852, 3.25324743229475, 4.4966109890523045, 8.482263109523572, 8.20130052321426, 8.237470121235186, 4.480242871957906, 4.879948907618764  …  9.050922960700445, 2.9904950887498165, 8.896718658703492, 4.2564636054155365, 7.533506843507512, 8.354551979727223, 3.965668892911861, 7.995976596049158, 9.144730434828231, 2.8803627523066186], [9.691721536329725, 9.672072514654653, 3.410971126784337, 4.408493791573149, 5.805688537811332, 9.382412696481289, 9.158721239250553, 9.270317309279104, 6.086057732153626, 6.36515555320002  …  9.628577637164755, 3.9435739537361134, 9.563705970103467, 5.605560968416697, 8.92505493242028, 9.324479690569454, 5.294962229194217, 9.155831762496165, 9.667383043657384, 3.8796153136306644], [9.884337483631652, 9.876808713108828, 4.671376181668783, 5.900526590138118, 7.253597983490372, 9.763575511584783, 9.673155695921732, 9.718585643086655, 7.827819838560349, 7.942835084323846  …  9.860077200614775, 5.228807493836076, 9.834951913308782, 7.128841557363847, 9.57572155794244, 9.740423565811316, 6.853314785030604, 9.67194448015121, 9.875009814116215, 5.248923211703802], [9.957136674504273, 9.954324740509268, 6.2418729048084405, 7.54228365878768, 8.677777162286322, 9.911705160350765, 9.877224941091498, 9.89459877071606, 9.073826736320296, 9.130098530741177  …  9.948065900171208, 6.755406904654905, 9.938642102807899, 8.639903445046725, 9.839616741594583, 9.902914443424692, 8.437176609080394, 9.876759610127987, 9.95365240989901, 6.869098034670007], [9.984188521675986, 9.983148207447, 7.913597675106515, 8.929557043966536, 9.469274672575054, 9.967335576174515, 9.954480244791009, 9.960964840560454, 9.638094608564304, 9.661366717579266  …  9.980831567847794, 8.346269396691756, 9.977339747526143, 9.452586936722318, 9.94039402603006, 9.964063620914372, 9.362059505457664, 9.954306356377334, 9.982899473270592, 8.51447937165603], [9.994177310230274, 9.993793885500637, 9.115955495886357, 9.577667097228062, 9.797991194863844, 9.987958506231504, 9.983205563700244, 9.985604047277869, 9.863746143166413, 9.872699515711048  …  9.99293975264096, 9.320682521412223, 9.991651776957257, 9.79141208798916, 9.97798889402029, 9.986749600819376, 9.75545498549046, 9.983141222650094, 9.993702097067322, 9.396938427274144], [9.997857102540046, 9.997715937336032, 9.655558338464282, 9.840377922583993, 9.924724692722078, 9.995566687785422, 9.993814945597167, 9.994699060762745, 9.949439469453646, 9.952788721251899  …  9.997401447337879, 9.738899080272185, 9.996927153265014, 9.922240427793461, 9.99189108322145, 9.995121233745387, 9.908626061796632, 9.99379122488745, 9.997682142643312, 9.769368572002069]], ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[Any[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0  …  2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0], Any[3.5260351450452934, 3.623938101199267, 3.4397254121005227, 1.8866021675944766, 2.844030719280549, 3.177226865854002, 2.457138434726195, 4.004363353136144, 1.9052935654646401, 1.7970098743925018  …  1.782386352169823, 3.3191826551063155, 2.6795388916287517, 2.26391147465598, 3.00263048063922, 2.7034348610445718, 1.866781107617289, 3.1912791561278744, 1.670059985152111, 2.1885679674410037], Any[5.550131490400967, 5.784703227041376, 5.30723138295471, 2.0092828184582783, 4.024613199849857, 4.797754626913278, 3.192934898656291, 6.448280911834183, 2.101923582161881, 1.873224309081588  …  1.8247777908585892, 5.0268007883063355, 3.7004963220142884, 2.732682433461479, 4.225745652803662, 3.825802199329373, 1.9690313140072162, 4.840353314699392, 1.6644374208996675, 2.6172366572306505], Any[7.61202839867029, 7.8859879840284455, 7.217859418917839, 2.356122259852743, 5.487448168274404, 6.649943560336089, 4.2423025464257424, 8.315150842569363, 2.5885910982871803, 2.1970607630434547  …  2.090090632684261, 6.809942550983014, 5.07018918647677, 3.4438877878051746, 5.5349101992706125, 5.390178848024755, 2.2913459916082486, 6.727698956994133, 1.9122116919180654, 3.3231625001145226], Any[8.965356710137431, 9.10235795626505, 8.758124791019126, 2.9630976005289282, 7.057707950196976, 8.403786097701966, 5.5636252925068534, 9.306307145639193, 3.4166325697533577, 2.808216239277542  …  2.6090486605387326, 8.363560452859739, 6.665051036565916, 4.420860362474483, 6.789264195919497, 7.20250996146554, 2.8688103857347107, 8.482263109523572, 2.4506597818322624, 4.338131569568164], Any[9.59277924652935, 9.649942058826626, 9.504271490369398, 3.876735084564969, 8.547185321093716, 9.346959917634045, 7.019732278012063, 9.733120731832225, 4.621057055996138, 3.768571099522823  …  3.4415405374556776, 9.3285380182301, 8.270306884342785, 5.637208794289921, 7.9238403252105725, 8.749876674145158, 3.7517438282316404, 9.382412696481289, 3.36977097157656, 5.636252025090841], Any[9.846235169793918, 9.868307190665586, 9.811733828798967, 5.103676596323418, 9.411504226926782, 9.749417870958618, 8.443554785356326, 9.900138062243128, 6.134887912321243, 5.094248250762305  …  4.6264162738502685, 9.742037111867544, 9.285570856386405, 7.002540190704491, 8.952094378066855, 9.500649038936785, 4.956844529561219, 9.763575511584783, 4.740959004747394, 7.10681455234124], Any[9.942877861630034, 9.951146198850015, 9.929906695348194, 6.563597015397393, 9.775143425849986, 9.906332385933652, 9.364949099496208, 9.963029417585457, 7.760898501320568, 6.674134307422801  …  6.113745984065448, 9.903527959036273, 9.724748570484937, 8.399517557861936, 9.587169941375679, 9.810311779983321, 6.405564647804988, 9.911705160350765, 6.4592565030758555, 8.598704590222113], Any[9.97890942350833, 9.981971675504445, 9.974098979264081, 8.10545061654384, 9.91608723245597, 9.965336256562349, 9.756610318890568, 9.986367395377515, 9.040528555947333, 8.295706022567641  …  7.7265091619965025, 9.964292118429482, 9.896948341787892, 9.344948561468975, 9.844060361058704, 9.929370749169065, 7.924705639831403, 9.967335576174515, 8.239056110668008, 9.434398386563798], Any[9.992230819080199, 9.993360081383347, 9.990455890421998, 9.208261085546175, 9.968965578861798, 9.987219784413385, 9.90906305628164, 9.994980490915466, 9.624262584341368, 9.297326450851838  …  9.023288299100617, 9.986834039203714, 9.961840685924324, 9.74861240798287, 9.942061890593767, 9.973900307413471, 9.12128271589148, 9.987958506231504, 9.271068459072234, 9.784212734560839], Any[9.997140460434233, 9.99755621576466, 9.996486701866313, 9.69341530383292, 9.988560372109868, 9.995294493731958, 9.966352408722104, 9.998152786880434, 9.8584164071627, 9.729505263475422  …  9.61707954704814, 9.995152349567588, 9.98592772991159, 9.906028163411968, 9.978607047787479, 9.990382362737325, 9.657755888099622, 9.995566687785422, 9.718909590081159, 9.919519563439026]]))</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>After running <code>solve</code>, we get <code>sol</code>, a <a href="../API/#Mermaid.MermaidSolution">MermaidSolution</a> instance. This stores all variables given in <code>state_names</code> at each timepoint.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidSolution-tutorial" href="#Mermaid.MermaidSolution-tutorial"><code>Mermaid.MermaidSolution</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidSolution</code></pre><p>Struct for storing the solution of a hybrid Mermaid simulation.</p><p><strong>Fields</strong></p><ul><li><code>t::Vector</code>: Time points.</li><li><code>u::Dict</code>: Dictionary mapping variables to their solution arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/cce24db0773121f7bece74bd39ee1994ba1218eb/src/types.jl#L129-L137">source</a></section></article><pre><code class="language-julia hljs">using Plots

plot(sol.t, sol[&quot;forest.life[1]&quot;], color=:green, label=&quot;Life&quot;)
plot!(sol.t, sol[&quot;forest.heat[1]&quot;], color=:red, label=&quot;Heat&quot;)</code></pre><img src="9100cb86.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/mtk/">ModelingToolkit »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 11:00">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
