<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Mermaid.jl</title><meta name="title" content="Tutorial · Mermaid.jl"/><meta property="og:title" content="Tutorial · Mermaid.jl"/><meta property="twitter:title" content="Tutorial · Mermaid.jl"/><meta name="description" content="Documentation for Mermaid.jl."/><meta property="og:description" content="Documentation for Mermaid.jl."/><meta property="twitter:description" content="Documentation for Mermaid.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mermaid.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Components"><span>Components</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li><li><a class="tocitem" href="#Solving-the-hybrid-model"><span>Solving the hybrid model</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/mtk/">ModelingToolkit</a></li></ul></li><li><a class="tocitem" href="../interface/">Mermaid Interface</a></li><li><a class="tocitem" href="../is_mermaid_right_for_me/">Is Mermaid right for me?</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will:</p><ul><li>Create a hybrid simulation between an Agent-based model, defined in Agents.jl, and an ODE system defined through DifferentialEquations.jl.</li><li>Introduce Mermaid Components for Agents.jl and DifferentialEquations.jl.</li><li>Demonstrate how these Components can be connected together through Connections.</li><li>Solve the hybrid model.</li><li>Visualise the results of the simulation.</li></ul><p>The example system we will use for this will be a model of a forest fire (governed by an Agent-based model), with the growth of each tree informed by an ODE model.</p><h2 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h2><p>To begin, we need to define our components. These will be an ODE model component for each tree, and an Agent-based model component for handling the forest level properties (in this case, the spread of heat/fire).</p><h3 id="ODE-Components"><a class="docs-heading-anchor" href="#ODE-Components">ODE Components</a><a id="ODE-Components-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Components" title="Permalink"></a></h3><p>To define the ODE model, let&#39;s have a look at how to define an ODE Component.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.ODEComponent-tutorial" href="#Mermaid.ODEComponent-tutorial"><code>Mermaid.ODEComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an ODE system, defined by an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">ODEProblem</a>.</p><p><strong>Fields</strong></p><ul><li><code>model::ODEProblem</code>: The ODE problem to be solved.</li><li><code>name::String=&quot;ODE Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping variable names (as strings) to their corresponding indices in the state vector or symbols from <a href="https://docs.sciml.ai/ModelingToolkit/stable/">ModelingToolkit</a>/<a href="https://docs.sciml.ai/Symbolics/stable/">Symbolics</a>.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ODE solver timestep), i.e. how frequently should the inputs and outputs be updated.</li><li><code>alg=Rodas5()</code>: The algorithm used for solving the ODEProblem.</li><li><code>intkwargs::Tuple=()</code>: Additional keyword arguments for the ODE solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/DiffEq.jl#L5-L16">source</a></section></article><p>We see that we need to define an <code>ODEProblem</code> to use in the component, so let&#39;s create one.</p><pre><code class="language-julia hljs">using DifferentialEquations
function tree!(du, u, p, t)
    x, y = u
    du[1] = 0
    du[2] = y*(1-y/10.0)-x*y
end
u0 = [4.0, 2.0]
tspan = (0.0, 10.0)
prob = ODEProblem(tree!, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#56b6c2">ODEProblem</span> with uType <span class="sgr38_2" style="color:#56b6c2">Vector{Float64}</span> and tType <span class="sgr38_2" style="color:#56b6c2">Float64</span>. In-place: <span class="sgr38_2" style="color:#56b6c2">true</span>
Non-trivial mass matrix: <span class="sgr38_2" style="color:#56b6c2">false</span>
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 4.0
 2.0</code></pre><p>Next, we want to wrap this ODEProblem inside an ODEComponent. For this, we will need to define the <code>state_names</code> field, and should generally provide a value for the <code>name</code> field (since component names in a hybrid simulation should be unique).</p><pre><code class="language-julia hljs">using Mermaid
comp1 = ODEComponent(
    model=prob,
    name=&quot;tree&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ())</code></pre><h3 id="Duplicated-Components"><a class="docs-heading-anchor" href="#Duplicated-Components">Duplicated Components</a><a id="Duplicated-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Duplicated-Components" title="Permalink"></a></h3><p>Since the <code>ODEProblem</code> is defined for only a single tree, we can efficiently simulate the ODE by generating a duplicated component. This component stores a single <code>ODEProblem</code> will solve across many different states. In this case, we can have a state for each tree in the Agent-based model. Let&#39;s have a look at how to define a <a href="../API/#Mermaid.DuplicatedComponent">DuplicatedComponent</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.DuplicatedComponent-tutorial" href="#Mermaid.DuplicatedComponent-tutorial"><code>Mermaid.DuplicatedComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DuplicatedComponent &lt;: AbstractComponent</code></pre><p>Represents a component that is duplicated in the simulation, allowing a single component to have multiple states.</p><p><strong>Fields</strong></p><ul><li><code>component::AbstractTimeDependentComponent</code>: The original component to be duplicated.</li><li><code>instances::Union{Int,Nothing}</code>: Number of instances of the component. If <code>nothing</code>, then the number is variable and determined by the simulation.</li><li><code>name::String</code>: Name of the duplicated component.</li><li><code>initial_states::Vector</code>: Vector of states for the duplicated component, where each state corresponds to a particular instance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/Duplicated.jl#L3-L13">source</a></section></article><pre><code class="language-julia hljs">dup_comp = DuplicatedComponent(
    component=comp1,
    instances=640,
    initial_states=[copy(u0) for _ in 1:640]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DuplicatedComponent(ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ()), 640, &quot;tree&quot;, [[4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]  …  [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]], 1.0, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2))</code></pre><h3 id="Agents.jl-Components"><a class="docs-heading-anchor" href="#Agents.jl-Components">Agents.jl Components</a><a id="Agents.jl-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Agents.jl-Components" title="Permalink"></a></h3><p>Now that we have created our <a href="../API/#Mermaid.ODEComponent">ODEComponent</a>, we can move on to the <a href="../API/#Mermaid.AgentsComponent">AgentsComponent</a>, so let&#39;s have a look at its documentation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.AgentsComponent-tutorial" href="#Mermaid.AgentsComponent-tutorial"><code>Mermaid.AgentsComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AgentsComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an agent-based model (ABM) using the Agents.jl package.</p><p><strong>Fields</strong></p><ul><li><code>model::StandardABM</code>: The agent-based model to be solved.</li><li><code>name::String=&quot;Agents Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping ConnectedVariable names (as strings) to their corresponding properties in the agent model. The properties differentiate between <code>:model</code> properties and <code>:agent</code> properties.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ABM solver timestep), i.e. how frequently should the inputs and outputs be updated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/Agents.jl#L5-L15">source</a></section></article><p>We can see that, again, we need to define the model (this time a <code>StandardABM</code> from <code>Agents.jl</code>), a <code>name</code> and a <code>state_names</code>.</p><pre><code class="language-julia hljs">using Agents, Random, Statistics
@agent struct Tree(GridAgent{2})
    heat::Float64 # Heat is averaged across neighbors, passed to ODE model
    life::Float64 # Life is informed by ODE model
end

function forest_fire(; density=0.4, griddims=(40, 40), seed=2)
    space = GridSpaceSingle(griddims; periodic=false, metric=:chebyshev)
    rng = Random.MersenneTwister(seed)
    forest = StandardABM(Tree, space; rng, agent_step! = tree_step!)
    for _ in 1:floor(density * prod(griddims))
        # Randomly place trees in the grid
        add_agent_single!(forest; heat=rand(), life=rand())
    end
    return forest
end

function tree_step!(tree, forest)
    nearbyheat = mean([getproperty(neighbor, :heat) for neighbor in nearby_agents(tree, forest, 1)])
    if isnan(nearbyheat)
        nearbyheat = 0.0
    end
    tree.heat = tree.heat * 0.9 + nearbyheat * 0.1
    if rand(abmrng(forest)) &lt; 1e-4 # Random chance of fire
        tree.heat = 10.0
    end
    # Simulate tree life cycle
    if tree.heat &gt; 1.0 &amp;&amp; tree.life &gt; 0
        # Tree on fire
        tree.heat += 1.0
    else
        # Tree not on fire so heat disappates
        tree.heat -= 0.1
    end
    if tree.heat &lt; 0.0
        tree.heat = 0.0
    end
end

forest = forest_fire()

comp2 = AgentsComponent(
    model=forest,
    name=&quot;forest&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentsComponent(StandardABM with 640 agents of type Tree
 agents container: Dict
 space: GridSpaceSingle with size (40, 40), metric=chebyshev, periodic=false
 scheduler: fastest, &quot;forest&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life), 1.0)</code></pre><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p>We can now set up the connections between the variables in the two components.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.Connector-tutorial" href="#Mermaid.Connector-tutorial"><code>Mermaid.Connector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Connector</code></pre><p>Represents a connection between multiple <a href="../API/#Mermaid.ConnectedVariable">ConnectedVariables</a>, possibly with a transformation function.</p><p><strong>Fields</strong></p><ul><li><code>inputs::Vector{ConnectedVariable}</code>: Input variables for the connector.</li><li><code>outputs::Vector{ConnectedVariable}</code>: Output variables for the connector.</li><li><code>func::Union{Nothing,Function}</code>: Optional function to transform inputs to outputs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/types.jl#L36-L45">source</a></section></article><pre><code class="language-julia hljs">conn1 = Connector(inputs=[&quot;forest.heat[1:640]&quot;], outputs=[&quot;tree[1:640].heat&quot;])
conn2 = Connector(inputs=[&quot;tree[1:640].life&quot;], outputs=[&quot;forest.life[1:640]&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Connector(ConnectedVariable[ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, 1:640)], ConnectedVariable[ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, 1:640, nothing)], nothing)</code></pre><h2 id="Solving-the-hybrid-model"><a class="docs-heading-anchor" href="#Solving-the-hybrid-model">Solving the hybrid model</a><a id="Solving-the-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-hybrid-model" title="Permalink"></a></h2><p>To create the hybrid model, we need to create a <a href="../API/#Mermaid.MermaidProblem">MermaidProblem</a>. We can then solve this using the <code>CommonSolve</code> interface.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidProblem-tutorial" href="#Mermaid.MermaidProblem-tutorial"><code>Mermaid.MermaidProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidProblem</code></pre><p>Struct for defining a Mermaid problem. This struct contains the components, connectors and other properties of the hybrid simulation.</p><p><strong>Fields</strong></p><ul><li><code>components::Vector</code>: Vector of Components.</li><li><code>connectors::Vector{Connector}</code>: Vector of <a href="../API/#Mermaid.Connector">Connector</a>.</li><li><code>max_t::Float64</code>=1.0: Maximum simulation time.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/types.jl#L112-L122">source</a></section></article><pre><code class="language-julia hljs">mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2], max_t=10.0)
alg = MinimumTimeStepper()
sol = solve(mp, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MermaidSolution(Any[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0], Dict{Any, Any}(ConnectedVariable(&quot;forest&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[[0.3529038207870472, 0.45067747962081006, 0.030528977188676865, 0.8709005360393482, 0.4106358041513869, 0.8410994478258942, 0.43558844720723966, 0.7164186747489983, 0.31800105560685366, 0.40240762623618054  …  0.21477302356155192, 0.48288537346048055, 0.17004277190972805, 0.2183184293883097, 0.4929124449657547, 0.5306946832925962, 0.6465769786768901, 0.15499284415435588, 0.5234206705797569, 0.501711221282436], [0.23852131860801165, 0.35690823104140257, 0.0, 0.7524308295873801, 0.2809066882352912, 0.6907666423637742, 0.3791204799553377, 0.5994979368253764, 0.1862009500461683, 0.30280676022126496  …  0.1131460110283754, 0.3792019442747, 0.12338625736382877, 0.12164833909801046, 0.3842850362699859, 0.41254064654791445, 0.5632394950136221, 0.07962281202006521, 0.4110930066234155, 0.426561802041006], [0.12899513443793184, 0.2616032982583867, 0.0, 0.6343919345495712, 0.15919079685605816, 0.5479111579000782, 0.3140773614326343, 0.48377410368863016, 0.06758085504155145, 0.20294572943813136  …  0.01628613042849264, 0.2747532658311209, 0.06794174660847857, 0.02285831609979136, 0.2765058809755897, 0.2992567715308453, 0.4757184555688456, 0.001602011946905263, 0.3007400560332537, 0.34595230655218], [0.025882634834923673, 0.1649773102971875, 0.0, 0.5168668432220025, 0.04532478449897351, 0.4140831028936135, 0.242018776885448, 0.36913354763473705, 0.0, 0.10362263394133123  …  0.0, 0.16973775201545802, 0.005047993956837166, 0.0, 0.16960409938964474, 0.1905586930815372, 0.3846739358821675, 0.0, 0.19399082071063953, 0.2607923552350637], [0.0, 0.06783907649286747, 0.0, 0.40001045263393986, 0.0, 0.28888373447784377, 0.1642150307128102, 0.25548864417455297, 0.0, 0.0057009861961589275  …  0.0, 0.06431591318357568, 0.0, 0.0, 0.06495935262658795, 0.08617177871772888, 0.29069064818324886, 0.0, 0.09056224814897088, 0.17189133259602316], [0.0, 0.0, 0.0, 0.2840318854911418, 0.0, 0.17163732224488912, 0.0817013328924984, 0.1452282420598942, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.19433512068850448, 0.0, 0.0, 0.07998355471439553], [0.0, 0.0, 0.0, 0.1711324042177599, 0.0, 0.06178164883314108, 0.0, 0.03929408592542999, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.09609290969528148, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.06249130647294762, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], ConnectedVariable(&quot;tree&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[Any[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0  …  4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0], Any[0.19510757531745282, 0.5895219186460354, 0.47691301517647144, 0.7667208631028802, 0.05086147142360131, 0.6808658875056743, 0.4666925734725984, 0.9616849664339017, 0.7338928190910579, 0.981927991468334  …  0.3375795695626457, 0.43076394762766335, 0.7825612578619325, 0.14687024356678802, 0.22926879356767926, 0.36084134967052783, 0.719351878965677, 0.8410994478258942, 0.89837471542769, 0.01717444145962488], Any[0.12411468250465979, 0.48096303159286236, 0.3722092405686299, 0.6655878065589902, 0.0, 0.5563692927466989, 0.3710085814512958, 0.7923704938015301, 0.6101832954124629, 0.8398093646243482  …  0.2495903598613243, 0.32900598492603395, 0.6391212640006259, 0.07715394078546806, 0.14182168525784336, 0.2762759925777457, 0.5713026429150141, 0.6907666423637742, 0.7719186391116728, 0.0], Any[0.04800627014465414, 0.3729243537299728, 0.26699063977041615, 0.5638330766527953, -1.959673826373241e-15, 0.43486755292342016, 0.2745935066010037, 0.6324958577881474, 0.48897156954504317, 0.7030953835319071  …  0.15996607544511773, 0.22852098915069305, 0.5002332074090383, 0.003948416723589032, 0.05190457935522033, 0.1885667873494742, 0.4299172237342741, 0.5479111579000782, 0.6473606961188088, -1.6977446617388962e-15], Any[0.0, 0.26587389419571517, 0.16139720978579838, 0.4615584867336979, -8.976539415558122e-16, 0.3177410198031473, 0.17751132266386074, 0.48058296759041164, 0.3704653059374413, 0.5709513370555298  …  0.0688482032562808, 0.1295513253835685, 0.3661500462528062, -3.0990518924089066e-16, 5.962266204368406e-16, 0.09817937026907969, 0.2945906019339205, 0.4140831028936135, 0.5245238914061837, 5.128805108540929e-16], Any[4.1093892828542426e-16, 0.16003177612067362, 0.057071872066740206, 0.3588481360736575, 2.4852367516728907e-20, 0.20595797043512917, 0.08099935930433663, 0.33539252279325504, 0.2557451714625374, 0.4428359084796041  …  1.1451171577824022e-16, 0.032287982243314445, 0.23870954893188853, 0.0, 0.0, 0.005516968347384563, 0.1676833650358576, 0.28888373447784377, 0.4032529439500585, -6.088943502148185e-17], Any[-1.710289977764086e-16, 0.05564952742843801, -4.2228795028977857e-16, 0.2557716124960103, 1.654849206679827e-17, 0.09921379079071155, -5.2304569071924106e-17, 0.20185327051392957, 0.1445061064789414, 0.319897246206464  …  1.33347792719081e-16, 0.0, 0.11858993481822444, 0.0, -2.107164701750937e-17, 7.321302443858304e-17, 0.05091502853227184, 0.17163732224488912, 0.28457528285074507, -7.306169348796863e-17], Any[-5.224474736411679e-17, 1.0656153508262796e-19, -7.892968114461691e-20, 0.15238660280940317, 9.733972059506614e-19, -2.7003014354364355e-16, 3.672605380411898e-16, 0.08166794346253661, 0.03647661681196143, 0.20233678007826286  …  2.8215773630135962e-21, 0.0, 0.006730941336401813, 1.649437255781011e-20, 9.309374626011159e-18, 4.316679626857069e-18, 4.295720200192064e-16, 0.06178164883314108, 0.16999442252783445, 0.0], Any[1.7566065171991494e-18, -9.94832189023437e-17, -1.1005433784651382e-16, 0.04874102193341083, -1.020421821088704e-21, -1.667604125490221e-16, 9.593402180460805e-17, 6.153804237450703e-16, -4.437651782635687e-16, 0.09111576042011954  …  -2.09689894484484e-18, 0.0, 0.0, -1.4379856113927447e-17, -1.816769659468589e-17, 3.263002181267451e-17, 2.2325318793078685e-17, 0.0, 0.059434017318034785, 0.0], Any[1.3586490968697622e-21, -2.377650398967994e-17, 8.10733561495554e-18, -5.125795281787758e-16, 1.206084228988132e-19, -4.036629329083437e-18, -1.882235147688204e-17, 2.1122212314973825e-16, -1.2046311674415524e-16, 2.5052503112279855e-16  …  1.7463980016429966e-17, 2.686965921687397e-17, 7.212067786922698e-17, -1.1417527154175747e-18, 1.147051613449485e-18, 1.7900520727668944e-17, 3.341764481670014e-17, -1.9450203047494977e-16, 0.0, 3.209828811906222e-18], Any[1.446191921607943e-18, 0.0, -4.041672997341582e-18, -2.373977375178746e-16, -9.414551983182327e-19, -9.261647906593396e-18, 4.0754701677495655e-18, -1.1212411839335313e-16, 2.878927942966586e-17, 1.5526778247285166e-16  …  6.426640721569081e-18, 0.0, 6.374711879993e-17, 3.0489667174338807e-18, -1.0174489789917328e-21, -2.476720514555687e-19, -1.5416272112912455e-17, -1.1040225951726738e-16, 1.7215127397426232e-16, 4.432113354929779e-19]], ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[[0.1448705554412113, 0.1688187562108805, 0.1134395315671618, 0.41058895626378056, 0.9033010610849223, 0.14052432128340042, 0.08771035180649733, 0.6939808835250343, 0.6825446109951938, 0.9068971971259396  …  0.3519836613000815, 0.6303496271381723, 0.6214096225635387, 0.0926944012339751, 0.1466515067014722, 0.11822589480248213, 0.19611515569381777, 0.8794374292920808, 0.4006758095595767, 0.2688031964545847], [2.981440556831522, 2.7351378720038837, 3.942142150260248, 1.8752672456343376, 2.8336720143982412, 1.9267815840478957, 2.7718962287461566, 2.1569746925855293, 3.0741392090193225, 2.8543138703513073  …  3.3637714733132844, 2.6581681959678947, 3.4967230174730974, 3.353420418335259, 2.634614161631196, 2.5475720954447625, 2.29684937628857, 3.542483006810223, 2.5641222433185296, 2.614103248664965], [4.412561836402094, 3.760136672816029, 6.388486832131576, 1.9806105721602167, 4.111117349125373, 2.1414781728339936, 3.725842587794425, 2.544443087237267, 4.704092430429638, 4.0572591076722055  …  5.297339853741197, 3.6138776623163062, 5.387326896671032, 5.2509597830636885, 3.574891889103251, 3.4040429687073916, 2.7598986577805156, 5.62360299489478, 3.4246879972720534, 3.428193168900255], [6.187817177110819, 5.055590780064453, 8.278678637830264, 2.303929574019695, 5.795248787270327, 2.6484494914172774, 4.818422960035411, 3.1984706838370354, 6.724770408534428, 5.555692708716929  …  7.449900319556153, 4.875564160042928, 7.2394824821369275, 7.380134119426496, 4.834231578287348, 4.594214400546262, 3.4209321984958287, 7.7654336891499725, 4.607257487569541, 4.443186415878753], [8.005753100066135, 6.509679014978035, 9.289451368718554, 2.8814877200036126, 7.642409600868224, 3.4985102288709906, 5.97514889955383, 4.157430377629303, 8.480564985327367, 7.169247741166181  …  8.88160645481491, 6.35525036628229, 8.739849118080333, 8.844933295222232, 6.325155309498132, 6.044611145841687, 4.297950766380618, 9.042766794452845, 6.038767588859327, 5.613224720387758], [9.160543064359812, 7.9667511587336275, 9.726312432510142, 3.764187153105276, 8.980834318216848, 4.718388248459783, 7.125928092425518, 5.412278162351543, 9.381656023871793, 8.697938599727767  …  9.557269146100538, 7.894132503037049, 9.49631658687393, 9.541611907392658, 7.8722926286960755, 7.58220758641671, 5.373726743390861, 9.625184317011238, 7.554891776336718, 6.857256696282613], [9.673876337281134, 9.141717686458621, 9.897543856916235, 4.969069246936967, 9.59925391525898, 6.228208788547739, 8.234123721124437, 6.857754720921398, 9.763273911023022, 9.478047447230043  …  9.832440089759514, 9.10635397459633, 9.808614521034764, 9.826338072858835, 9.095645856100093, 8.95009499657585, 6.587253803845715, 9.858772140819195, 8.936057448049667, 8.097613203898314], [9.877500678041415, 9.666155857725274, 9.962062491996237, 6.417205964281194, 9.848743208908422, 7.830457583919141, 9.268745864044451, 8.329505565512061, 9.911590515254163, 9.801435674140203  …  9.93769831097641, 9.651571471524584, 9.92873164630445, 9.935404360197536, 9.647144851702016, 9.586320511406022, 7.85503090791765, 9.94757716065461, 9.580380941766734, 9.20451691529367], [9.954583244924095, 9.87454199503831, 9.986009882410807, 7.941636665321768, 9.94381855415912, 9.07501951318141, 9.717970597821468, 9.31291992065484, 9.96729313173895, 9.926024492431248  …  9.976989686471873, 9.86893534374277, 9.973663143508022, 9.976139084609601, 9.867232075654414, 9.843733278681851, 9.087248337399062, 9.980650542198479, 9.84142518983185, 9.691870700488218], [9.983243874052343, 9.953477477805068, 9.994848630916215, 9.12961266697206, 9.9792579787544, 9.638619256882846, 9.894364105463287, 9.735780175935147, 9.987942861241782, 9.972657702028805  …  9.99152243967232, 9.95138109511288, 9.99029482351028, 9.991208585473434, 9.950743930276833, 9.94193930774714, 9.643658438795892, 9.992873006490209, 9.941073082576889, 9.884394700697587], [9.993829069439673, 9.982834507004032, 9.9981042457633, 9.661188966002014, 9.99235922716547, 9.863952415638746, 9.960877202057201, 9.901150043786961, 9.995561037951575, 9.989923677354698  …  9.996879520854055, 9.982058624664761, 9.99642745152686, 9.996763931217558, 9.98182276584201, 9.978561619365305, 9.865889561570288, 9.997376870113486, 9.978240581758913, 9.957157885971018]], ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[Any[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0  …  2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0], Any[3.4216419039228456, 2.4172994902605076, 2.672289707538492, 2.061180999250993, 3.874085537540958, 2.227158842281273, 2.6966153537022617, 1.7261826085055958, 2.1232376655337295, 1.6944946539457724  …  3.0218234531644543, 2.783741499208521, 2.0318452588641507, 3.567410496664194, 3.32166743467859, 2.9607135925270796, 2.1512770199007103, 1.9267815840478957, 1.8289208869874407, 3.9870792798649717], Any[5.309483587133855, 3.084589938469171, 3.6495334475089103, 2.3134552016539764, 6.322937210162438, 2.710829057813788, 3.6774408070164926, 1.7825386074108236, 2.4891043518343596, 1.680120712117274  …  4.413215912638852, 3.8988651246853014, 2.341847335672841, 5.659736721228862, 5.134700628855775, 4.256040205007517, 2.6034680066760196, 2.1414781728339936, 1.905932566411225, 6.4323864583411385], Any[7.288955430662234, 4.041109411955154, 4.9376032817136215, 2.773916807091619, 8.23777047526423, 3.4961744205631575, 4.93187155732541, 2.1179620748098054, 3.1318609039904404, 1.8910040337788674  …  6.043352732822074, 5.311414714428293, 2.9606878493219257, 7.7777527596449, 7.139429996704512, 5.784776717064452, 3.408051604650387, 2.6484494914172774, 2.2073617056840895, 8.305548553150881], Any[8.796403313564303, 5.274171033249536, 6.441248850217817, 3.475447995129763, 9.27046332700838, 4.606962868277388, 6.359393281318139, 2.78656095194639, 4.092617876229206, 2.3493909204352916  …  7.675670726628921, 6.867455897354201, 3.948501411612927, 9.048882075546027, 8.71542623558068, 7.350758736930985, 4.61535835923221, 3.4985102288709906, 2.768672959345201, 9.301889687598143], Any[9.520764201795116, 6.688484771568999, 7.986349579851594, 4.437205129806472, 9.71865024787806, 5.983451542814847, 7.804276119003254, 3.8807633262004257, 5.358692899967049, 3.1202266654347093  …  8.997679259909724, 8.375221355198956, 5.31090039896037, 9.627721893554067, 9.48566896410857, 8.796532617777057, 6.167630388517392, 4.718388248459783, 3.647291598812917, 9.73132714785186], Any[9.81819184101715, 8.139538692980068, 9.15127662111894, 5.6305864273662705, 9.89462352462046, 7.473275799741925, 9.062108530450482, 5.408689015639055, 6.8246308653186425, 4.257100931339784  …  9.606348090058377, 9.333862781523255, 6.922831814591109, 9.85974612267503, 9.804432248054106, 9.520819163481804, 7.852947582480627, 6.228208788547739, 4.866279406363985, 9.89945359985988], Any[9.93233895559477, 9.224371598346478, 9.670075579283239, 6.967524565238456, 9.96097413538949, 8.893809940547227, 9.63323139373652, 7.1824171362945135, 8.32682470451674, 5.724202949335602  …  9.851492044969875, 9.74416971094413, 8.555129001153535, 9.947941920527944, 9.927154806683317, 9.81822221420638, 9.08622264448544, 7.830457583919141, 6.34717824080927, 9.962774427340886], Any[9.975001777348478, 9.699953280221607, 9.876042687701638, 8.336424765733703, 9.985607548188627, 9.562466930625805, 9.861871370040737, 8.738870122521027, 9.311722851141104, 7.3482927387369  …  9.944849226767928, 9.904338632981045, 9.415042677997286, 9.980785609724835, 9.973077628790525, 9.93235039789115, 9.643238654802438, 9.07501951318141, 7.916542981561561, 9.986273162782398], Any[9.990788895009024, 9.887485000737547, 9.95403848375027, 9.316122530852107, 9.994700483474997, 9.834469883858663, 9.948737676794952, 9.49591997723565, 9.735298925528564, 8.828208602436014  …  9.979639826758971, 9.964593723093637, 9.776557695485549, 9.99292264505351, 9.99007869379778, 9.975005846551086, 9.865731497283717, 9.638619256882846, 9.117392709018047, 9.994945749463291], Any[9.996609409226476, 9.958311427323219, 9.983042381150266, 9.737055352519551, 9.998049761012712, 9.938461217304525, 9.981079988423385, 9.808466361176913, 9.900966942186995, 9.534484210829227  …  9.992500247526898, 9.98694525573409, 9.916623731824025, 9.997395148012814, 9.996347764560577, 9.990790392122696, 9.950182474017984, 9.863952415638746, 9.656151362505886, 9.998139997720795]]))</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>After running <code>solve</code>, we get <code>sol</code>, a <a href="../API/#Mermaid.MermaidSolution">MermaidSolution</a> instance. This stores all variables given in <code>state_names</code> at each timepoint.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidSolution-tutorial" href="#Mermaid.MermaidSolution-tutorial"><code>Mermaid.MermaidSolution</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidSolution</code></pre><p>Struct for storing the solution of a hybrid Mermaid simulation.</p><p><strong>Fields</strong></p><ul><li><code>t::Vector</code>: Time points.</li><li><code>u::Dict</code>: Dictionary mapping variables to their solution arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/d04490fc877ecae02eb9de74babbd11d1818ac60/src/types.jl#L129-L137">source</a></section></article><pre><code class="language-julia hljs">using Plots

plot(sol.t, sol[&quot;forest.life[1]&quot;], color=:green, label=&quot;Life&quot;)
plot!(sol.t, sol[&quot;forest.heat[1]&quot;], color=:red, label=&quot;Heat&quot;)</code></pre><img src="7f3d7cc4.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/mtk/">ModelingToolkit »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 10:36">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
