<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Mermaid.jl</title><meta name="title" content="Tutorial · Mermaid.jl"/><meta property="og:title" content="Tutorial · Mermaid.jl"/><meta property="twitter:title" content="Tutorial · Mermaid.jl"/><meta name="description" content="Documentation for Mermaid.jl."/><meta property="og:description" content="Documentation for Mermaid.jl."/><meta property="twitter:description" content="Documentation for Mermaid.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mermaid.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Components"><span>Components</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li><li><a class="tocitem" href="#Solving-the-hybrid-model"><span>Solving the hybrid model</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/mtk/">ModelingToolkit</a></li></ul></li><li><a class="tocitem" href="../interface/">Mermaid Interface</a></li><li><a class="tocitem" href="../is_mermaid_right_for_me/">Is Mermaid right for me?</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mjowen/Mermaid.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will:</p><ul><li>Create a hybrid simulation between an Agent-based model, defined in Agents.jl, and an ODE system defined through DifferentialEquations.jl.</li><li>Introduce Mermaid Components for Agents.jl and DifferentialEquations.jl.</li><li>Demonstrate how these Components can be connected together through Connections.</li><li>Solve the hybrid model.</li><li>Visualise the results of the simulation.</li></ul><p>The example system we will use for this will be a model of a forest fire (governed by an Agent-based model), with the growth of each tree informed by an ODE model.</p><h2 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h2><p>To begin, we need to define our components. These will be an ODE model component for each tree, and an Agent-based model component for handling the forest level properties (in this case, the spread of heat/fire).</p><h3 id="ODE-Components"><a class="docs-heading-anchor" href="#ODE-Components">ODE Components</a><a id="ODE-Components-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Components" title="Permalink"></a></h3><p>To define the ODE model, let&#39;s have a look at how to define an ODE Component.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.ODEComponent-tutorial" href="#Mermaid.ODEComponent-tutorial"><code>Mermaid.ODEComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ODEComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an ODE system, defined by an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">ODEProblem</a>.</p><p><strong>Fields</strong></p><ul><li><code>model::ODEProblem</code>: The ODE problem to be solved.</li><li><code>name::String=&quot;ODE Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping variable names (as strings) to their corresponding indices in the state vector or symbols from <a href="https://docs.sciml.ai/ModelingToolkit/stable/">ModelingToolkit</a>/<a href="https://docs.sciml.ai/Symbolics/stable/">Symbolics</a>.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ODE solver timestep), i.e. how frequently should the inputs and outputs be updated.</li><li><code>alg=Rodas5()</code>: The algorithm used for solving the ODEProblem.</li><li><code>intkwargs::Tuple=()</code>: Additional keyword arguments for the ODE solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/DiffEq.jl#L5-L16">source</a></section></article><p>We see that we need to define an <code>ODEProblem</code> to use in the component, so let&#39;s create one.</p><pre><code class="language-julia hljs">using DifferentialEquations
function tree!(du, u, p, t)
    x, y = u
    du[1] = 0
    du[2] = y*(1-y/10.0)-x*y
end
u0 = [4.0, 2.0]
tspan = (0.0, 10.0)
prob = ODEProblem(tree!, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#56b6c2">ODEProblem</span> with uType <span class="sgr38_2" style="color:#56b6c2">Vector{Float64}</span> and tType <span class="sgr38_2" style="color:#56b6c2">Float64</span>. In-place: <span class="sgr38_2" style="color:#56b6c2">true</span>
Non-trivial mass matrix: <span class="sgr38_2" style="color:#56b6c2">false</span>
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 4.0
 2.0</code></pre><p>Next, we want to wrap this ODEProblem inside an ODEComponent. For this, we will need to define the <code>state_names</code> field, and should generally provide a value for the <code>name</code> field (since component names in a hybrid simulation should be unique).</p><pre><code class="language-julia hljs">using Mermaid
comp1 = ODEComponent(
    model=prob,
    name=&quot;tree&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ())</code></pre><h3 id="Duplicated-Components"><a class="docs-heading-anchor" href="#Duplicated-Components">Duplicated Components</a><a id="Duplicated-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Duplicated-Components" title="Permalink"></a></h3><p>Since the <code>ODEProblem</code> is defined for only a single tree, we can efficiently simulate the ODE by generating a duplicated component. This component stores a single <code>ODEProblem</code> will solve across many different states. In this case, we can have a state for each tree in the Agent-based model. Let&#39;s have a look at how to define a <a href="../API/#Mermaid.DuplicatedComponent">DuplicatedComponent</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.DuplicatedComponent-tutorial" href="#Mermaid.DuplicatedComponent-tutorial"><code>Mermaid.DuplicatedComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DuplicatedComponent &lt;: AbstractComponent</code></pre><p>Represents a component that is duplicated in the simulation, allowing a single component to have multiple states.</p><p><strong>Fields</strong></p><ul><li><code>component::AbstractTimeDependentComponent</code>: The original component to be duplicated.</li><li><code>instances::Union{Int,Nothing}</code>: Number of instances of the component. If <code>nothing</code>, then the number is variable and determined by the simulation.</li><li><code>name::String</code>: Name of the duplicated component.</li><li><code>initial_states::Vector</code>: Vector of states for the duplicated component, where each state corresponds to a particular instance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/Duplicated.jl#L3-L13">source</a></section></article><pre><code class="language-julia hljs">dup_comp = DuplicatedComponent(
    component=comp1,
    instances=640,
    initial_states=[copy(u0) for _ in 1:640]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DuplicatedComponent(ODEComponent(SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, SciMLBase.NullParameters, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}, SciMLBase.StandardODEProblem}(SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.tree!), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing, Nothing, Nothing}(Main.tree!, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED, nothing, nothing, nothing, nothing), [4.0, 2.0], (0.0, 10.0), SciMLBase.NullParameters(), Base.Pairs{Symbol, Union{}, Tuple{}, @NamedTuple{}}(), SciMLBase.StandardODEProblem()), &quot;tree&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2), 1.0, OrdinaryDiffEqRosenbrock.Rodas5{0, ADTypes.AutoForwardDiff{nothing, Nothing}, Nothing, typeof(OrdinaryDiffEqCore.DEFAULT_PRECS), Val{:forward}(), true, nothing, typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!)}(nothing, OrdinaryDiffEqCore.DEFAULT_PRECS, OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, ADTypes.AutoForwardDiff()), ()), 640, &quot;tree&quot;, [[4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]  …  [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0], [4.0, 2.0]], 1.0, Dict{String, Any}(&quot;heat&quot; =&gt; 1, &quot;life&quot; =&gt; 2))</code></pre><h3 id="Agents.jl-Components"><a class="docs-heading-anchor" href="#Agents.jl-Components">Agents.jl Components</a><a id="Agents.jl-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Agents.jl-Components" title="Permalink"></a></h3><p>Now that we have created our <a href="../API/#Mermaid.ODEComponent">ODEComponent</a>, we can move on to the <a href="../API/#Mermaid.AgentsComponent">AgentsComponent</a>, so let&#39;s have a look at its documentation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.AgentsComponent-tutorial" href="#Mermaid.AgentsComponent-tutorial"><code>Mermaid.AgentsComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AgentsComponent &lt;: AbstractTimeDependentComponent</code></pre><p>A component that represents an agent-based model (ABM) using the Agents.jl package.</p><p><strong>Fields</strong></p><ul><li><code>model::StandardABM</code>: The agent-based model to be solved.</li><li><code>name::String=&quot;Agents Component&quot;</code>: The name of the component.</li><li><code>state_names::Dict{String,Any} = Dict{String,Any}()</code>: A dictionary mapping ConnectedVariable names (as strings) to their corresponding properties in the agent model. The properties differentiate between <code>:model</code> properties and <code>:agent</code> properties.</li><li><code>time_step::Float64=1.0</code>: The time step for the component (not the ABM solver timestep), i.e. how frequently should the inputs and outputs be updated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/Agents.jl#L5-L15">source</a></section></article><p>We can see that, again, we need to define the model (this time a <code>StandardABM</code> from <code>Agents.jl</code>), a <code>name</code> and a <code>state_names</code>.</p><pre><code class="language-julia hljs">using Agents, Random, Statistics
@agent struct Tree(GridAgent{2})
    heat::Float64 # Heat is averaged across neighbors, passed to ODE model
    life::Float64 # Life is informed by ODE model
end

function forest_fire(; density=0.4, griddims=(40, 40), seed=2)
    space = GridSpaceSingle(griddims; periodic=false, metric=:chebyshev)
    rng = Random.MersenneTwister(seed)
    forest = StandardABM(Tree, space; rng, agent_step! = tree_step!)
    for _ in 1:floor(density * prod(griddims))
        # Randomly place trees in the grid
        add_agent_single!(forest; heat=rand(), life=rand())
    end
    return forest
end

function tree_step!(tree, forest)
    nearbyheat = mean([getproperty(neighbor, :heat) for neighbor in nearby_agents(tree, forest, 1)])
    if isnan(nearbyheat)
        nearbyheat = 0.0
    end
    tree.heat = tree.heat * 0.9 + nearbyheat * 0.1
    if rand(abmrng(forest)) &lt; 1e-4 # Random chance of fire
        tree.heat = 10.0
    end
    # Simulate tree life cycle
    if tree.heat &gt; 1.0 &amp;&amp; tree.life &gt; 0
        # Tree on fire
        tree.heat += 1.0
    else
        # Tree not on fire so heat disappates
        tree.heat -= 0.1
    end
    if tree.heat &lt; 0.0
        tree.heat = 0.0
    end
end

forest = forest_fire()

comp2 = AgentsComponent(
    model=forest,
    name=&quot;forest&quot;,
    state_names=Dict(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life)
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AgentsComponent(StandardABM with 640 agents of type Tree
 agents container: Dict
 space: GridSpaceSingle with size (40, 40), metric=chebyshev, periodic=false
 scheduler: fastest, &quot;forest&quot;, Dict{String, Any}(&quot;heat&quot; =&gt; :heat, &quot;life&quot; =&gt; :life), 1.0)</code></pre><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p>We can now set up the connections between the variables in the two components.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.Connector-tutorial" href="#Mermaid.Connector-tutorial"><code>Mermaid.Connector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Connector</code></pre><p>Represents a connection between multiple <a href="../API/#Mermaid.ConnectedVariable">ConnectedVariables</a>, possibly with a transformation function.</p><p><strong>Fields</strong></p><ul><li><code>inputs::Vector{ConnectedVariable}</code>: Input variables for the connector.</li><li><code>outputs::Vector{ConnectedVariable}</code>: Output variables for the connector.</li><li><code>func::Union{Nothing,Function}</code>: Optional function to transform inputs to outputs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/types.jl#L36-L45">source</a></section></article><pre><code class="language-julia hljs">conn1 = Connector(inputs=[&quot;forest.heat[1:640]&quot;], outputs=[&quot;tree[1:640].heat&quot;])
conn2 = Connector(inputs=[&quot;tree[1:640].life&quot;], outputs=[&quot;forest.life[1:640]&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Connector(ConnectedVariable[ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, 1:640)], ConnectedVariable[ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, 1:640, nothing)], nothing)</code></pre><h2 id="Solving-the-hybrid-model"><a class="docs-heading-anchor" href="#Solving-the-hybrid-model">Solving the hybrid model</a><a id="Solving-the-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-hybrid-model" title="Permalink"></a></h2><p>To create the hybrid model, we need to create a <a href="../API/#Mermaid.MermaidProblem">MermaidProblem</a>. We can then solve this using the <code>CommonSolve</code> interface.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidProblem-tutorial" href="#Mermaid.MermaidProblem-tutorial"><code>Mermaid.MermaidProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidProblem</code></pre><p>Struct for defining a Mermaid problem. This struct contains the components, connectors and other properties of the hybrid simulation.</p><p><strong>Fields</strong></p><ul><li><code>components::Vector</code>: Vector of Components.</li><li><code>connectors::Vector{Connector}</code>: Vector of <a href="../API/#Mermaid.Connector">Connector</a>.</li><li><code>max_t::Float64</code>=1.0: Maximum simulation time.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/types.jl#L112-L122">source</a></section></article><pre><code class="language-julia hljs">mp = MermaidProblem(components=[dup_comp, comp2], connectors=[conn1, conn2], max_t=10.0)
alg = MinimumTimeStepper()
sol = solve(mp, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MermaidSolution(Any[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0], Dict{Any, Any}(ConnectedVariable(&quot;forest&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[[0.777441245605361, 0.3783670628351319, 0.6456491143971088, 0.9084906218487417, 0.6151312976773686, 0.874598757866055, 0.11096349362920488, 0.2883570529282167, 0.10463405351295996, 0.27856999519869796  …  0.3168030250748948, 0.8313339307374512, 0.9702769426286456, 0.5177412795469412, 0.6979573273929932, 0.12208306653691159, 0.49605038196886797, 0.27745310208158824, 0.1528365564714662, 0.8672485256105348], [0.6848250958172056, 0.2779015443163916, 0.5261093761394782, 0.7342376982781313, 0.4989763252238337, 0.7338442757592247, 0.09907492426442502, 0.21570452752577948, 0.0, 0.1971145331478927  …  0.20841436831878815, 0.7184115026823252, 0.8206866716985358, 0.4259647135845187, 0.5924423737627489, 0.013313757744312524, 0.3947792788560579, 0.19914698852037774, 0.0724519098543866, 0.7329004520420698], [0.5885740340068798, 0.1770009325605141, 0.4084876996004875, 0.5720462672885569, 0.3861261986116107, 0.5998398112165632, 0.06913858287246952, 0.13862154626654663, 0.0, 0.11217997862344944  …  0.10316586766936292, 0.605856721540254, 0.6762995329157399, 0.3327258793514374, 0.4866665289463592, 0.0, 0.2923951759758131, 0.11677284598295751, 0.0, 0.6020287187829053], [0.4893718994862851, 0.0777315235891704, 0.29292343469313986, 0.42129210717292853, 0.2774234649671866, 0.471375881551759, 0.024614206159150137, 0.0588566317559599, 0.0, 0.02600519331757553  …  0.0025956443238869392, 0.4936628447894381, 0.5365469292116175, 0.23811556519393248, 0.38072185905397404, 0.0, 0.18911305046933577, 0.03096230827053345, 0.0, 0.4749360263924297], [0.3877970799468199, 0.0, 0.1807706638778803, 0.2807437393532026, 0.17281460364085835, 0.34799856497238946, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.3818221172135594, 0.4009616181298056, 0.14222797819749453, 0.27467924856379067, 0.0, 0.08511079665922919, 0.0, 0.0, 0.3516364230213802], [0.2843837597359452, 0.0, 0.07387569284623458, 0.15266936541788237, 0.07221963790624883, 0.23065056253503366, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.27033512261053994, 0.26919289271372326, 0.04516801833621184, 0.16859254292564677, 0.0, 0.0, 0.0, 0.0, 0.23212439889647427], [0.17960825475559658, 0.0, 0.0, 0.03740242887609413, 0.0, 0.11860942962652521, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.1593776246662786, 0.14240646821928565, 0.0, 0.06413001876588731, 0.0, 0.0, 0.0, 0.0, 0.11637848523803043], [0.07401652430022487, 0.0, 0.0, 0.0, 0.0, 0.01125003449644231, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.049159668524252326, 0.0281658213973571, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0065063565793056916], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], ConnectedVariable(&quot;tree&quot;, &quot;heat&quot;, nothing, nothing) =&gt; Any[Any[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0  …  4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 4.0], Any[0.078519146652277, 0.5486467035801214, 0.5617017568827689, 0.5426405019164358, 0.8320453789686965, 0.2389630342048117, 0.12339204791835434, 0.6770827788468547, 0.058659310644305296, 0.5360897512430433  …  0.1028026320044596, 0.1760565416761447, 0.5282488844351142, 0.0821288484077366, 0.9545990077000037, 0.28435978752073965, 0.7781162494127805, 0.874598757866055, 0.4267356919758719, 0.5143839283871959], Any[0.004743842627810413, 0.4287857532660003, 0.4557294874562563, 0.4799938252142283, 0.7085350674677476, 0.15870544740825646, 0.01736711818161618, 0.5899539378104103, 0.0, 0.43524677824690194  …  0.020234503647465207, 0.1071137109276471, 0.40020755454737833, 0.028340428925396705, 0.8239405702237275, 0.19955544072689071, 0.642141708852875, 0.7338442757592247, 0.32815667367901236, 0.3996635107209795], Any[0.0, 0.3113826494616231, 0.3481468545857819, 0.40690851055536414, 0.5868639310008362, 0.0765299863078858, 0.0, 0.498887405671004, 3.8252578625714126e-16, 0.334720925255801  …  -1.4051197930878918e-15, 0.03360714320167382, 0.2774628354181282, 0.0, 0.6951391095678451, 0.11167746087660271, 0.5124851702642935, 0.5998398112165632, 0.2283671923076316, 0.28858465245704357], Any[7.959556594665194e-16, 0.19605133759292329, 0.23956409309229562, 0.32567486312890737, 0.46720268453009894, 0.0, -4.205067890619269e-16, 0.40458529639213203, 1.0549738389239591e-19, 0.23433433496269404  …  2.7882612729242195e-16, 0.0, 0.1604808144913157, 0.0, 0.5681302272434458, 0.024852644841897906, 0.38938411274574725, 0.471375881551759, 0.1289582538798694, 0.18072103929766412], Any[9.030457846103311e-18, 0.08412766200252736, 0.13107522290577306, 0.23824723439783282, 0.3509469448835959, -4.948064339635732e-16, -1.2223932573343333e-16, 0.30762924109548506, -1.3167827218954512e-20, 0.13395662297592528  …  -5.258839043748104e-17, 0.0, 0.05042183536949155, -8.988741289628436e-18, 0.4428623844060625, 2.92998890354063e-16, 0.2722814204471298, 0.34799856497238946, 0.031194506470809708, 0.07744714568479506], Any[6.98209968542147e-22, 3.7575078683202867e-16, 0.027479414840899878, 0.14623961895367307, 0.23787113009517882, 3.411065382281259e-17, 1.1183226698626515e-16, 0.20850102413190422, 2.673676183237896e-17, 0.03412921271895472  …  -1.1418500984255976e-16, -1.0595913005913251e-17, -1.9241097996080636e-17, 6.430643756706464e-17, 0.31931706355143996, 2.298074208120915e-16, 0.1606736967048051, 0.23065056253503366, 2.8437204830838723e-19, -4.594292544982277e-16], Any[-2.48862032665455e-17, 1.3445338045390736e-16, 5.016792552106758e-16, 0.05098225234913585, 0.1277926709747155, 0.0, -7.18096311071677e-18, 0.10759966030526871, 2.593048016953146e-17, -1.7868712248310595e-19  …  2.6922707354322497e-17, -9.246228027127792e-18, 4.58313712922527e-16, -3.6288645909063335e-18, 0.1976263462641957, 1.260510912020758e-17, 0.05411870956311332, 0.11860942962652521, 1.3333668783180226e-16, -2.276078384096832e-16], Any[-1.3359991326605668e-17, -4.027731618673351e-18, 0.0, -1.8337610192984554e-17, 0.021536436671515197, -9.71605058647166e-19, 1.7634274412725803e-18, 0.005335514380496114, 0.0, 3.4272827153782276e-17  …  2.2119344955527976e-21, -2.0444586125167035e-17, -5.613157241353443e-21, -4.839966114150088e-19, 0.08090800099787973, -6.848954417506287e-21, 0.0, 0.011250034496441704, 0.0, -4.3229534614524725e-18], Any[-1.1192062931296124e-18, 1.94282614290846e-18, -5.650825360018662e-17, 2.1840628491742622e-16, -1.4086368648071848e-16, 5.530324974251875e-18, 0.0, -3.5884401145505344e-16, -3.3930695054878873e-22, -1.9599852905555982e-18  …  1.1189780660945591e-18, -1.0182579617246395e-17, 0.0, -5.3470404477835345e-18, -4.948615240390038e-16, -4.041014362897813e-18, -1.3048657217088908e-16, 0.0, -8.118402388235376e-18, -1.9582006620428805e-18], Any[-1.6690837952740565e-18, 1.7453718857396153e-17, 2.3300596072945943e-17, -8.337860966837021e-17, 3.417246339411171e-17, -3.3317415990624784e-18, 1.4451425272902855e-18, 5.851681042402407e-17, -2.18029509792865e-19, 0.0  …  7.270373412766072e-19, 1.7941660203956155e-18, -3.564983626937415e-18, -9.41677502635891e-19, -4.383251648712198e-16, 5.675529102907788e-19, -3.321929298243611e-17, 6.034562377032834e-19, -3.400059395105108e-21, 0.0]], ConnectedVariable(&quot;forest&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[[0.8433458322000943, 0.31198812255836583, 0.3107381715467131, 0.6789014454114933, 0.4198413259436785, 0.10087611108441286, 0.9071619366184867, 0.19887522818406356, 0.8731798215822534, 0.7249114141100024  …  0.2006541350597052, 0.114712586931359, 0.036689539223820566, 0.4803512426748797, 0.07068691609252009, 0.44477858902444634, 0.8532703774056667, 0.353058961224481, 0.5163309371551158, 0.7997320102149068], [2.0412844578773695, 2.915419823170806, 2.2987629881405858, 1.8121282454655454, 2.362530719125751, 1.8689652620064405, 3.679486887794266, 3.154911828338423, 3.6995642964426976, 3.1819989360481364  …  3.0773669641638963, 1.9439482886872868, 1.712664207665287, 2.5771124612561356, 2.193158440323005, 3.6444490481605096, 2.627282805392005, 3.185104335098048, 3.5490852538380877, 1.8815101216314238], [2.2561842287429186, 4.204751698171216, 2.8532757284054022, 1.957464008286341, 2.9839751702634745, 2.008750670179224, 5.67208473872775, 4.673357482689579, 6.148153833417863, 4.772121175341877  …  4.6226194817987185, 2.103823836972074, 1.725374533301713, 3.393949093056727, 2.5942346541280457, 6.029703289728486, 3.5357820882828586, 4.767351466792424, 5.662239721426996, 2.02157325757649], [2.6616266843981067, 5.794286189450028, 3.7109890214205308, 2.4133760353244287, 3.9044826193961675, 2.403497486140841, 7.430612216917962, 6.350918997499485, 8.126973099094464, 6.55653319759722  …  6.482735380664339, 2.4805455765013766, 1.9812229052513597, 4.46130848427937, 3.2371091863555557, 8.050059224503213, 4.738083172393482, 6.530212607701941, 7.801448529384119, 2.4110630424751864], [3.291831452480036, 7.466254805436258, 4.8884699646498015, 3.2444163127114, 5.113841754571315, 3.0969073940002687, 8.725272993167032, 7.922032993989439, 9.218428218829008, 8.231019523190541  …  8.321178297368322, 3.1110386021802614, 2.5153247109429553, 5.726853326500536, 4.15196660047834, 9.181818010462692, 6.160817620714053, 8.187038392377737, 9.060672270324888, 3.094716731825618], [4.175651611453755, 8.890187410543923, 6.312008971802302, 4.515751953598958, 6.513080811905023, 4.137382570807221, 9.48996444675347, 9.119974857432691, 9.697535321480876, 9.26730745909862  …  9.309089825700742, 4.035249489472678, 3.40567464720606, 7.082461823308838, 5.326812249141819, 9.682596440017084, 7.660617808912306, 9.246724788747885, 9.632628389494016, 4.12284962701783], [5.304940325721439, 9.560959595424753, 7.814955506443041, 6.159807504044446, 7.944334110930461, 5.502343820925034, 9.806119764687576, 9.65718770680099, 9.886561977667473, 9.717368073196162  …  9.734229453916882, 5.250814468987162, 4.7095680006747624, 8.420077982716561, 6.682311893469028, 9.880843726363867, 8.990060041290867, 9.709034579031535, 9.861641166983476, 5.484079983409298], [6.612933314987865, 9.833880662654716, 9.067364424644717, 7.923312362797487, 9.130844398549405, 7.055179683058672, 9.927790729336953, 9.87109343004042, 9.95796703864699, 9.894134836934596  …  9.900558744127009, 6.675486945955293, 6.360860452948229, 9.354294426149211, 8.088162721713253, 9.955832106777745, 9.603136935369319, 9.890954497615079, 9.94865148392642, 7.054305951881607], [7.99254459170238, 9.938239577640772, 9.6354092447803, 9.12060060948097, 9.661668840826815, 8.60280441879569, 9.973313855832554, 9.952188265194728, 9.984495683989472, 9.960791877714048  …  9.963186003266241, 8.168850095557515, 8.100468389172395, 9.75235064497032, 9.199996641283601, 9.983706030303443, 9.850251118713114, 9.959605928030642, 9.98104836442129, 8.630059124399425], [9.154175112742205, 9.977190475397895, 9.86271550941096, 9.657474597530637, 9.872815674587164, 9.436207763936626, 9.990166116065986, 9.98235738692717, 9.994290655925392, 9.985540109699198  …  9.986425253938055, 9.238179747853312, 9.205870677026248, 9.907446226897546, 9.69002239458923, 9.993999570490343, 9.944383991650104, 9.985101774798473, 9.9930195427876, 9.448254277512886], [9.671289817687272, 9.991596521649324, 9.949053688173512, 9.871207557192777, 9.952832148585282, 9.784928090984424, 9.99637996642948, 9.993502231559999, 9.997898875338233, 9.994675495930803  …  9.995001820466014, 9.705586171615195, 9.69244079897304, 9.96575087707728, 9.883689833820597, 9.997791665077308, 9.979467470621513, 9.994513938117663, 9.99743082734268, 9.789701596162603]], ConnectedVariable(&quot;tree&quot;, &quot;life&quot;, nothing, nothing) =&gt; Any[Any[2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0  …  2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0], Any[3.7834332831143977, 2.5071478741733344, 2.4781224448245323, 2.5206064764305656, 1.9426928282812843, 3.2937708308868032, 3.640404322115349, 2.2347504722408633, 3.848334988746477, 2.5353609186029034  …  3.705391791530736, 3.4785869027207132, 2.5531257261698332, 3.7718323740701925, 1.7374051900954277, 3.1659497446372877, 2.0400376929166963, 1.8689652620064405, 2.7936709857349813, 2.5848199926057034], Any[6.210481933557955, 3.317044022190817, 3.21260490418263, 3.1863449709233516, 2.121567584507685, 5.037520510417836, 6.006070452278789, 2.638595698673771, 6.2972174539518715, 3.3263085145716085  …  6.0588687736381175, 5.439250203094101, 3.4458227479423833, 6.08629271273165, 1.741107216365753, 4.746540388943239, 2.3430808631104463, 2.008750670179224, 3.9116215786092474, 3.4790324048163943], Any[8.166804209879981, 4.470263910417584, 4.243240149281473, 4.018240700438325, 2.5396916923186152, 6.938815444170445, 8.034616359170164, 3.2439426196153804, 8.221642148710384, 4.393728610702431  …  8.069488344860671, 7.459654757484884, 4.714637686906828, 8.086980358549937, 1.9622526548271766, 6.539207923656419, 2.93032868282818, 2.403497486140841, 5.32300601168973, 4.702096763289101], Any[9.237225962803821, 5.92294616591945, 5.549486490624422, 5.011623261270091, 3.240045172846644, 8.603671269082449, 9.17450557816723, 4.076449517164547, 9.262936274637996, 5.691234394757413  …  9.19115798584984, 8.886683501347209, 6.278264488384288, 9.19943257957519, 2.426604208838886, 8.227276145544892, 3.843953877322762, 3.0969073940002687, 6.878478654466348, 6.173016566196233], Any[9.705194545106753, 7.515674545538645, 7.022823707299802, 6.129588433845694, 4.2582617768613, 9.436594434328152, 9.67960309478326, 5.130557832745628, 9.715601958508627, 7.1019794022859974  …  9.686416808287515, 9.559429494506698, 7.9244998937751125, 9.689797935639804, 3.1975598985738882, 9.265559076550073, 5.083964178391646, 4.137382570807221, 8.387761011171644, 7.710099117094809], Any[9.88948778414191, 8.915830659951284, 8.489910315284297, 7.314114235777012, 5.568834336035824, 9.785083212472596, 9.879696302950489, 6.352630464145062, 9.893462716915158, 8.494641473804096  …  9.8823063260101, 9.833281941529828, 9.12117200217779, 9.883602212650585, 4.331539722234549, 9.716662715158789, 6.5510849440003165, 5.502343820925034, 9.33959902840599, 9.015026421112456], Any[9.95905867528714, 9.571814677713684, 9.385849726931879, 8.510048177104526, 7.052713569817496, 9.919848677812872, 9.955403407473574, 7.654746822919286, 9.960541337473854, 9.387987728598539  …  9.956378307264455, 9.938014631065966, 9.657685736094576, 9.956862226988685, 5.805485362804109, 9.89386578586934, 8.068151108686703, 7.055179683058672, 9.746470876954776, 9.613592283118237], Any[9.98489941976307, 9.838101086218643, 9.764941815995076, 9.394895527930956, 8.541044298597614, 9.970363455273109, 9.9835471226235, 8.955126725199166, 9.985447641250191, 9.765800352393297  …  9.983908061815368, 9.977106977756291, 9.87128488358258, 9.984087042091117, 7.456531776454288, 9.960691482457959, 9.190456259371874, 8.60280441879569, 9.905212801478, 9.854290971057864], Any[9.994439483045657, 9.939825099736987, 9.912224128931491, 9.768556271693106, 9.408817973533495, 9.989076608463753, 9.993940865405397, 9.58846832589195, 9.99464141542613, 9.912549530083428  …  9.994074052383809, 9.991565768994002, 9.952259904863505, 9.994139995223769, 8.88507743930366, 9.985503108330859, 9.686131292480212, 9.436207763936626, 9.964919418451695, 9.945898310715437], Any[9.99795366619362, 9.97777799649276, 9.967528542705935, 9.913593832730815, 9.774087817634888, 9.995978622495093, 9.997770051626965, 9.844569096099542, 9.998027962687841, 9.967649587311902  …  9.997819086844896, 9.996895478288494, 9.982383901835629, 9.997843364600833, 9.558788371863296, 9.994661963098386, 9.88219856542053, 9.784928090984424, 9.987065835343502, 9.98002865083798]]))</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>After running <code>solve</code>, we get <code>sol</code>, a <a href="../API/#Mermaid.MermaidSolution">MermaidSolution</a> instance. This stores all variables given in <code>state_names</code> at each timepoint.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mermaid.MermaidSolution-tutorial" href="#Mermaid.MermaidSolution-tutorial"><code>Mermaid.MermaidSolution</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MermaidSolution</code></pre><p>Struct for storing the solution of a hybrid Mermaid simulation.</p><p><strong>Fields</strong></p><ul><li><code>t::Vector</code>: Time points.</li><li><code>u::Dict</code>: Dictionary mapping variables to their solution arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mjowen/Mermaid.jl/blob/1125405a9f818b59df2ec7e36172728609e19964/src/types.jl#L129-L137">source</a></section></article><pre><code class="language-julia hljs">using Plots

plot(sol.t, sol[&quot;forest.life[1]&quot;], color=:green, label=&quot;Life&quot;)
plot!(sol.t, sol[&quot;forest.heat[1]&quot;], color=:red, label=&quot;Heat&quot;)</code></pre><img src="37aeffc2.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/mtk/">ModelingToolkit »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 10:13">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
